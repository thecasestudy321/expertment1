webpackJsonp([239],{287:function(e,t,i){"use strict";i(555),nb.substance0021=extendsClass(ScienceMain,{frame0:function(){var e=this,t=new nb.ThreeJSPlugin(this),i=new THREE.HemisphereLight(16777215,16777215,.6);i.color.setHSL(.6,1,.6),i.groundColor.setHSL(.095,1,.75),i.position.set(0,500,0),t.add(i);var o=new THREE.DirectionalLight(16777215);o.position.set(0,1e3,300),this.box1.rotation.x=Math.PI/2,this.box1.rotation.z=Math.PI/2;var n=0;this.top.scale.x=1.6,this.box2.scale.x=1.6,this.top.position.z=this.box2.position.z=-600,this.top.position.x=500,this.box2.position.x=500,this.top.position.y=200,this.box2.position.y=-500,this.box1.position.x=2e3,t.add(o),this.btn.addEventListener(TouchEvent.TAP,function(){TweenMax.isTweening(e.box1.rotation)||(n++,TweenMax.to(e.box1.rotation,.5,{z:Math.PI*n+Math.PI/2}),e.onStepComplete())});var r=new nb.THREE.GraphicLine3D;r.lineStyle(16777215,3),t.add(r),this.rotateCamera=function(){var i=-.25*Math.PI,o=0*Math.PI,n=0*Math.PI;t.rotateCamera(i,o,n,1.5,{ease:Expo.easeInOut,onComplete:function(){t.addDrag(e.box1)}})},this.rotateCamera(),this.onUpdate=function(){if(!1!==t.isLoaded()){t.render();var e=.8*this.top.geometry.parameters.width,i=this.top.geometry.parameters.height,o=new THREE.Vector3(-e/2,0,0),a=new THREE.Vector3(e/2,0,0);o=this.box2.localToWorld(o),a=this.box2.localToWorld(a);var s=this.box1.position.clone(),l=s.sub(o).length(),c=(s=this.box1.position.clone()).sub(a).length(),p=1e5/(l*l)+-1e5/(c*c);n%2==0?(this.box2.rotation.y=p>0?2*-p:1.5*p,this.box2.rotation.y>25*Math.PI/180&&(this.box2.rotation.y=25*Math.PI/180),this.box2.rotation.y<-25*Math.PI/180&&(this.box2.rotation.y=-25*Math.PI/180)):(this.box2.rotation.y=p<0?2*-p:1.5*p,this.box2.rotation.y>25*Math.PI/180&&(this.box2.rotation.y=25*Math.PI/180),this.box2.rotation.y<-25*Math.PI/180&&(this.box2.rotation.y=-25*Math.PI/180)),r.clear(),r.moveTo(o),r.lineTo(this.top.localToWorld(new THREE.Vector3(-e/2,-i/2,0))),r.moveTo(a),r.lineTo(this.top.localToWorld(new THREE.Vector3(e/2,-i/2,0)))}}},frame1:function(){},start:function(){this.menu.addStepFromObj(this.info),this.menu.setExperimentName(this.info.labName),this.bindScriptToSprite(this.frame0,"frame0")},info:{experimentImport:"我们已经知道了，磁铁具有磁力，每个磁铁有两个磁极，那磁铁的两个磁极有不同之处么，两个磁极之间是怎样相互作用的？",labName:"磁铁的相互作用",title0:"用磁铁去接近悬挂的磁铁观察现象",CONCLUSION:"磁铁具有两个磁极，S极是南极，N极是北极。磁铁的两极，同极相斥，异极相吸。"},const:{},event:{}}),e.exports=nb.substance0021},555:function(e,t){THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null},THREE.Projector=function(){var e,t,i,o,n,r,a,s,l,c,p,E=[],h=0,f=[],m=0,d=[],u=0,x=[],v=0,y=[],R=0,T={objects:[],lights:[],elements:[]},H=new THREE.Vector3,g=new THREE.Vector4,w=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),S=new THREE.Box3,M=new Array(3),b=(new Array(4),new THREE.Matrix4),C=new THREE.Matrix4,z=new THREE.Matrix4,V=new THREE.Matrix3,L=new THREE.Frustum,j=new THREE.Vector4,P=new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var B=new function(){var e=[],t=[],o=null,r=null,s=new THREE.Matrix3,l=function(e){var t=e.position,i=e.positionWorld,o=e.positionScreen;i.copy(t).applyMatrix4(p),o.copy(i).applyMatrix4(C);var n=1/o.w;o.x*=n,o.y*=n,o.z*=n,e.visible=o.x>=-1&&o.x<=1&&o.y>=-1&&o.y<=1&&o.z>=-1&&o.z<=1},c=function(e,t,i){return!0===e.visible||!0===t.visible||!0===i.visible||(M[0]=e.positionScreen,M[1]=t.positionScreen,M[2]=i.positionScreen,w.isIntersectionBox(S.setFromPoints(M)))},E=function(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0};return{setObject:function(i){r=(o=i).material,s.getNormalMatrix(o.matrixWorld),e.length=0,t.length=0},projectVertex:l,checkTriangleVisibility:c,checkBackfaceCulling:E,pushVertex:function(e,t,o){(i=I()).position.set(e,t,o),l(i)},pushNormal:function(t,i,o){e.push(t,i,o)},pushUv:function(e,i){t.push(e,i)},pushLine:function(e,t){var i=f[e],n=f[t];(a=W()).id=o.id,a.v1.copy(i),a.v2.copy(n),a.z=(i.positionScreen.z+n.positionScreen.z)/2,a.material=o.material,T.elements.push(a)},pushTriangle:function(i,a,l){var p=f[i],h=f[a],m=f[l];if(!1!==c(p,h,m)&&(r.side===THREE.DoubleSide||!0===E(p,h,m))){(n=N()).id=o.id,n.v1.copy(p),n.v2.copy(h),n.v3.copy(m),n.z=(p.positionScreen.z+h.positionScreen.z+m.positionScreen.z)/3;for(var d=0;d<3;d++){var u=3*arguments[d],x=n.vertexNormalsModel[d];x.set(e[u],e[u+1],e[u+2]),x.applyMatrix3(s).normalize();var v=2*arguments[d];n.uvs[d].set(t[v],t[v+1])}n.vertexNormalsLength=3,n.material=o.material,T.elements.push(n)}}}};function I(){if(o===m){var e=new THREE.RenderableVertex;return f.push(e),m++,o++,e}return f[o++]}function N(){if(r===u){var e=new THREE.RenderableFace;return d.push(e),u++,r++,e}return d[r++]}function W(){if(s===v){var e=new THREE.RenderableLine;return x.push(e),v++,s++,e}return x[s++]}function k(){if(c===R){var e=new THREE.RenderableSprite;return y.push(e),R++,c++,e}return y[c++]}function F(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function D(e,t){var i=0,o=1,n=e.z+e.w,r=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return n>=0&&r>=0&&a>=0&&s>=0||!(n<0&&r<0||a<0&&s<0)&&(n<0?i=Math.max(i,n/(n-r)):r<0&&(o=Math.min(o,n/(n-r))),a<0?i=Math.max(i,a/(a-s)):s<0&&(o=Math.min(o,a/(a-s))),!(o<i)&&(e.lerp(t,i),t.lerp(e,1-o),!0))}this.projectScene=function(i,m,d,u){r=0,s=0,c=0,T.elements.length=0,!0===i.autoUpdate&&i.updateMatrixWorld(),void 0===m.parent&&m.updateMatrixWorld(),b.copy(m.matrixWorldInverse.getInverse(m.matrixWorld)),C.multiplyMatrices(m.projectionMatrix,b),L.setFromMatrix(C),t=0,T.objects.length=0,T.lights.length=0,i.traverseVisible(function(i){if(i instanceof THREE.Light)T.lights.push(i);else if(i instanceof THREE.Mesh||i instanceof THREE.Line||i instanceof THREE.Sprite){if(!1===i.material.visible)return;!1!==i.frustumCulled&&!0!==L.intersectsObject(i)||((e=function(){if(t===h){var e=new THREE.RenderableObject;return E.push(e),h++,t++,e}return E[t++]}()).id=i.id,e.object=i,H.setFromMatrixPosition(i.matrixWorld),H.applyProjection(C),e.z=H.z,T.objects.push(e))}}),!0===d&&T.objects.sort(F);for(var x=0,v=T.objects.length;x<v;x++){var y=T.objects[x].object,R=y.geometry;if(B.setObject(y),p=y.matrixWorld,o=0,y instanceof THREE.Mesh){if(R instanceof THREE.BufferGeometry){var w=R.attributes,S=R.offsets;if(void 0===w.position)continue;for(var M=0,O=(He=w.position.array).length;M<O;M+=3)B.pushVertex(He[M],He[M+1],He[M+2]);if(void 0!==w.normal){var G=w.normal.array;for(M=0,O=G.length;M<O;M+=3)B.pushNormal(G[M],G[M+1],G[M+2])}if(void 0!==w.uv){var A=w.uv.array;for(M=0,O=A.length;M<O;M+=2)B.pushUv(A[M],A[M+1])}if(void 0!==w.index){var U=w.index.array;if(S.length>0)for(x=0;x<S.length;x++){var J=S[x],q=J.index;for(M=J.start,O=J.start+J.count;M<O;M+=3)B.pushTriangle(U[M]+q,U[M+1]+q,U[M+2]+q)}else for(M=0,O=U.length;M<O;M+=3)B.pushTriangle(U[M],U[M+1],U[M+2])}else for(M=0,O=He.length/3;M<O;M+=3)B.pushTriangle(M,M+1,M+2)}else if(R instanceof THREE.Geometry){var K=R.vertices,Q=R.faces,X=R.faceVertexUvs[0];V.getNormalMatrix(p);for(var Y=(ce=y.material)instanceof THREE.MeshFaceMaterial,Z=!0===Y?y.material:null,$=0,_=K.length;$<_;$++){var ee=K[$];if(H.copy(ee),!0===ce.morphTargets)for(var te=R.morphTargets,ie=y.morphTargetInfluences,oe=0,ne=te.length;oe<ne;oe++){var re=ie[oe];if(0!==re){var ae=te[oe].vertices[$];H.x+=(ae.x-ee.x)*re,H.y+=(ae.y-ee.y)*re,H.z+=(ae.z-ee.z)*re}}B.pushVertex(H.x,H.y,H.z)}for(var se=0,le=Q.length;se<le;se++){var ce,pe=Q[se];if(void 0!==(ce=!0===Y?Z.materials[pe.materialIndex]:y.material)){var Ee=ce.side,he=f[pe.a],fe=f[pe.b],me=f[pe.c];if(!1!==B.checkTriangleVisibility(he,fe,me)){var de=B.checkBackfaceCulling(he,fe,me);if(Ee!==THREE.DoubleSide){if(Ee===THREE.FrontSide&&!1===de)continue;if(Ee===THREE.BackSide&&!0===de)continue}(n=N()).id=y.id,n.v1.copy(he),n.v2.copy(fe),n.v3.copy(me),n.normalModel.copy(pe.normal),!1!==de||Ee!==THREE.BackSide&&Ee!==THREE.DoubleSide||n.normalModel.negate(),n.normalModel.applyMatrix3(V).normalize();for(var ue=pe.vertexNormals,xe=0,ve=Math.min(ue.length,3);xe<ve;xe++){var ye=n.vertexNormalsModel[xe];ye.copy(ue[xe]),!1!==de||Ee!==THREE.BackSide&&Ee!==THREE.DoubleSide||ye.negate(),ye.applyMatrix3(V).normalize()}n.vertexNormalsLength=ue.length;var Re=X[se];if(void 0!==Re)for(var Te=0;Te<3;Te++)n.uvs[Te].copy(Re[Te]);n.color=pe.color,n.material=ce,n.z=(he.positionScreen.z+fe.positionScreen.z+me.positionScreen.z)/3,T.elements.push(n)}}}}}else if(y instanceof THREE.Line){if(R instanceof THREE.BufferGeometry){if(void 0!==(w=R.attributes).position){var He;for(M=0,O=(He=w.position.array).length;M<O;M+=3)B.pushVertex(He[M],He[M+1],He[M+2]);if(void 0!==w.index)for(M=0,O=(U=w.index.array).length;M<O;M+=2)B.pushLine(U[M],U[M+1]);else{var ge=y.mode===THREE.LinePieces?2:1;for(M=0,O=He.length/3-1;M<O;M+=ge)B.pushLine(M,M+1)}}}else if(R instanceof THREE.Geometry){if(z.multiplyMatrices(C,p),0===(K=y.geometry.vertices).length)continue;(he=I()).positionScreen.copy(K[0]).applyMatrix4(z);for(ge=y.mode===THREE.LinePieces?2:1,$=1,_=K.length;$<_;$++)(he=I()).positionScreen.copy(K[$]).applyMatrix4(z),($+1)%ge>0||(fe=f[o-2],j.copy(he.positionScreen),P.copy(fe.positionScreen),!0===D(j,P)&&(j.multiplyScalar(1/j.w),P.multiplyScalar(1/P.w),(a=W()).id=y.id,a.v1.positionScreen.copy(j),a.v2.positionScreen.copy(P),a.z=Math.max(j.z,P.z),a.material=y.material,y.material.vertexColors===THREE.VertexColors&&(a.vertexColors[0].copy(y.geometry.colors[$]),a.vertexColors[1].copy(y.geometry.colors[$-1])),T.elements.push(a)))}}else if(y instanceof THREE.Sprite){g.set(p.elements[12],p.elements[13],p.elements[14],1),g.applyMatrix4(C);var we=1/g.w;g.z*=we,g.z>=-1&&g.z<=1&&((l=k()).id=y.id,l.x=g.x*we,l.y=g.y*we,l.z=g.z,l.object=y,l.rotation=y.rotation,l.scale.x=y.scale.x*Math.abs(l.x-(g.x+m.projectionMatrix.elements[0])/(g.w+m.projectionMatrix.elements[12])),l.scale.y=y.scale.y*Math.abs(l.y-(g.y+m.projectionMatrix.elements[5])/(g.w+m.projectionMatrix.elements[13])),l.material=y.material,T.elements.push(l))}}return!0===u&&T.elements.sort(F),T}},THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){console.log("THREE.CanvasRenderer",THREE.REVISION);var t=THREE.Math.smoothstep;e=e||{};var i,o,n,r,a,s,l,c,p,E,h,f,m,d,u,x,v,y,R,T,H=this,g=new THREE.Projector,w=void 0!==e.canvas?e.canvas:document.createElement("canvas"),S=w.width,M=w.height,b=Math.floor(S/2),C=Math.floor(M/2),z=0,V=0,L=S,j=M,P=1,B=w.getContext("2d",{alpha:!0===e.alpha}),I=new THREE.Color(0),N=!0===e.alpha?0:1,W=1,k=0,F=null,D=null,O=null,G=null,A=null,U=[],J=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),q=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),K=new THREE.Color,Q=new THREE.Color,X={},Y=new THREE.Box2,Z=new THREE.Box2,$=new THREE.Box2,_=new THREE.Color,ee=new THREE.Color,te=new THREE.Color,ie=new THREE.Vector3,oe=new THREE.Vector3,ne=new THREE.Vector3,re=new THREE.Matrix3;function ae(e,t,i){de(i.opacity),ue(i.blending);var o=t.scale.x*b,n=t.scale.y*C,r=.5*Math.sqrt(o*o+n*n);if($.min.set(e.x-r,e.y-r),$.max.set(e.x+r,e.y+r),i instanceof THREE.SpriteMaterial){var a=i.map;if(null!==a&&void 0!==a.image){!1===a.hasEventListener("update",Ee)&&(a.image.width>0&&he(a),a.addEventListener("update",Ee));var s=X[a.id];Te(void 0!==s?s:"rgba( 0, 0, 0, 1 )");var l=a.image,c=l.width*a.offset.x,p=l.height*a.offset.y,E=l.width*a.repeat.x,h=l.height*a.repeat.y,f=o/E,m=n/h;B.save(),B.translate(e.x,e.y),0!==i.rotation&&B.rotate(i.rotation),B.translate(-o/2,-n/2),B.scale(f,m),B.translate(-c,-p),B.fillRect(c,p,E,h),B.restore()}else Te(i.color.getStyle()),B.save(),B.translate(e.x,e.y),0!==i.rotation&&B.rotate(i.rotation),B.scale(o,-n),B.fillRect(-.5,-.5,1,1),B.restore()}else i instanceof THREE.SpriteCanvasMaterial&&(Re(i.color.getStyle()),Te(i.color.getStyle()),B.save(),B.translate(e.x,e.y),0!==i.rotation&&B.rotate(i.rotation),B.scale(o,n),i.program(B),B.restore())}function se(e,t,i,o){if(de(o.opacity),ue(o.blending),B.beginPath(),B.moveTo(e.positionScreen.x,e.positionScreen.y),B.lineTo(t.positionScreen.x,t.positionScreen.y),o instanceof THREE.LineBasicMaterial){if(xe(o.linewidth),ve(o.linecap),ye(o.linejoin),o.vertexColors!==THREE.VertexColors)Re(o.color.getStyle());else{var n=i.vertexColors[0].getStyle(),r=i.vertexColors[1].getStyle();if(n===r)Re(n);else{try{var a=B.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,n),a.addColorStop(1,r)}catch(e){a=n}Re(a)}}B.stroke(),$.expandByScalar(2*o.linewidth)}else o instanceof THREE.LineDashedMaterial&&(xe(o.linewidth),ve(o.linecap),ye(o.linejoin),Re(o.color.getStyle()),He([o.dashSize,o.gapSize]),B.stroke(),$.expandByScalar(2*o.linewidth),He([]))}function le(e,i,o,a,s,l,g,w){if(H.info.render.vertices+=3,H.info.render.faces++,de(w.opacity),ue(w.blending),c=e.positionScreen.x,p=e.positionScreen.y,E=i.positionScreen.x,h=i.positionScreen.y,f=o.positionScreen.x,m=o.positionScreen.y,function(e,t,i,o,n,r){B.beginPath(),B.moveTo(e,t),B.lineTo(i,o),B.lineTo(n,r),B.closePath()}(c,p,E,h,f,m),(w instanceof THREE.MeshLambertMaterial||w instanceof THREE.MeshPhongMaterial)&&null===w.map)q.copy(w.color),K.copy(w.emissive),w.vertexColors===THREE.FaceColors&&q.multiply(g.color),J.copy(_),oe.copy(e.positionWorld).add(i.positionWorld).add(o.positionWorld).divideScalar(3),function(e,t,i){for(var o=0,r=n.length;o<r;o++){var a=n[o];if(Q.copy(a.color),a instanceof THREE.DirectionalLight){var s=ie.setFromMatrixPosition(a.matrixWorld).normalize();if((l=t.dot(s))<=0)continue;l*=a.intensity,i.add(Q.multiplyScalar(l))}else if(a instanceof THREE.PointLight){var l;if(s=ie.setFromMatrixPosition(a.matrixWorld),(l=t.dot(ie.subVectors(s,e).normalize()))<=0)continue;if(0==(l*=0==a.distance?1:1-Math.min(e.distanceTo(s)/a.distance,1)))continue;l*=a.intensity,i.add(Q.multiplyScalar(l))}}}(oe,g.normalModel,J),J.multiply(q).add(K),!0===w.wireframe?ce(J,w.wireframeLinewidth,w.wireframeLinecap,w.wireframeLinejoin):pe(J);else if(w instanceof THREE.MeshBasicMaterial||w instanceof THREE.MeshLambertMaterial||w instanceof THREE.MeshPhongMaterial){if(null!==w.map)w.map.mapping===THREE.UVMapping&&(d=g.uvs,fe(c,p,E,h,f,m,d[a].x,d[a].y,d[s].x,d[s].y,d[l].x,d[l].y,w.map));else null!==w.envMap?w.envMap.mapping===THREE.SphericalReflectionMapping&&(ne.copy(g.vertexNormalsModel[a]).applyMatrix3(re),u=.5*ne.x+.5,x=.5*ne.y+.5,ne.copy(g.vertexNormalsModel[s]).applyMatrix3(re),v=.5*ne.x+.5,y=.5*ne.y+.5,ne.copy(g.vertexNormalsModel[l]).applyMatrix3(re),R=.5*ne.x+.5,T=.5*ne.y+.5,fe(c,p,E,h,f,m,u,x,v,y,R,T,w.envMap)):(J.copy(w.color),w.vertexColors===THREE.FaceColors&&J.multiply(g.color),!0===w.wireframe?ce(J,w.wireframeLinewidth,w.wireframeLinecap,w.wireframeLinejoin):pe(J))}else w instanceof THREE.MeshDepthMaterial?(J.r=J.g=J.b=1-t(e.positionScreen.z*e.positionScreen.w,r.near,r.far),!0===w.wireframe?ce(J,w.wireframeLinewidth,w.wireframeLinecap,w.wireframeLinejoin):pe(J)):w instanceof THREE.MeshNormalMaterial?(ne.copy(g.normalModel).applyMatrix3(re),J.setRGB(ne.x,ne.y,ne.z).multiplyScalar(.5).addScalar(.5),!0===w.wireframe?ce(J,w.wireframeLinewidth,w.wireframeLinecap,w.wireframeLinejoin):pe(J)):(J.setRGB(1,1,1),!0===w.wireframe?ce(J,w.wireframeLinewidth,w.wireframeLinecap,w.wireframeLinejoin):pe(J))}function ce(e,t,i,o){xe(t),ve(i),ye(o),Re(e.getStyle()),B.stroke(),$.expandByScalar(2*t)}function pe(e){Te(e.getStyle()),B.fill()}function Ee(e){he(e.target)}function he(e){if(!(e instanceof THREE.CompressedTexture)){var t=e.wrapS===THREE.RepeatWrapping,i=e.wrapT===THREE.RepeatWrapping,o=e.image,n=document.createElement("canvas");n.width=o.width,n.height=o.height;var r=n.getContext("2d");r.setTransform(1,0,0,-1,0,o.height),r.drawImage(o,0,0),X[e.id]=B.createPattern(n,!0===t&&!0===i?"repeat":!0===t&&!1===i?"repeat-x":!1===t&&!0===i?"repeat-y":"no-repeat")}}function fe(e,t,i,o,n,r,a,s,l,c,p,E,h){if(!(h instanceof THREE.DataTexture)){!1===h.hasEventListener("update",Ee)&&(void 0!==h.image&&h.image.width>0&&he(h),h.addEventListener("update",Ee));var f=X[h.id];if(void 0===f)return Te("rgba(0,0,0,1)"),void B.fill();Te(f);var m,d,u,x,v,y,R,T,H=h.offset.x/h.repeat.x,g=h.offset.y/h.repeat.y,w=h.image.width*h.repeat.x,S=h.image.height*h.repeat.y;l=(l+H)*w,c=(c+g)*S,p=(p+H)*w,E=(E+g)*S,i-=e,o-=t,n-=e,r-=t,0!==(R=(l-=a=(a+H)*w)*(E-=s=(s+g)*S)-(p-=a)*(c-=s))&&(v=e-(m=(E*i-c*n)*(T=1/R))*a-(u=(l*n-p*i)*T)*s,y=t-(d=(E*o-c*r)*T)*a-(x=(l*r-p*o)*T)*s,B.save(),B.transform(m,d,u,x,v,y),B.fill(),B.restore())}}function me(e,t,i){var o,n=t.x-e.x,r=t.y-e.y,a=n*n+r*r;0!==a&&(n*=o=i/Math.sqrt(a),r*=o,t.x+=n,t.y+=r,e.x-=n,e.y-=r)}function de(e){W!==e&&(B.globalAlpha=e,W=e)}function ue(e){k!==e&&(e===THREE.NormalBlending?B.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?B.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(B.globalCompositeOperation="darker"),k=e)}function xe(e){O!==e&&(B.lineWidth=e,O=e)}function ve(e){G!==e&&(B.lineCap=e,G=e)}function ye(e){A!==e&&(B.lineJoin=e,A=e)}function Re(e){F!==e&&(B.strokeStyle=e,F=e)}function Te(e){D!==e&&(B.fillStyle=e,D=e)}function He(e){U.length!==e.length&&(B.setLineDash(e),U=e)}void 0===B.setLineDash&&(B.setLineDash=function(){}),this.domElement=w,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getPixelRatio=function(){return P},this.setPixelRatio=function(e){P=e},this.setSize=function(e,t,i){S=e*P,M=t*P,w.width=S,w.height=M,b=Math.floor(S/2),C=Math.floor(M/2),!1!==i&&(w.style.width=e+"px",w.style.height=t+"px"),Y.min.set(-b,-C),Y.max.set(b,C),Z.min.set(-b,-C),Z.max.set(b,C),W=1,k=0,F=null,D=null,O=null,G=null,A=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,o){z=e*P,V=t*P,L=i*P,j=o*P},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(e,t){I.set(e),N=void 0!==t?t:1,Z.min.set(-b,-C),Z.max.set(b,C)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return I},this.getClearAlpha=function(){return N},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===Z.empty()&&(Z.intersect(Y),Z.expandByScalar(2),Z.min.x=Z.min.x+b,Z.min.y=-Z.min.y+C,Z.max.x=Z.max.x+b,Z.max.y=-Z.max.y+C,N<1&&B.clearRect(0|Z.min.x,0|Z.max.y,Z.max.x-Z.min.x|0,Z.min.y-Z.max.y|0),N>0&&(ue(THREE.NormalBlending),de(1),Te("rgba("+Math.floor(255*I.r)+","+Math.floor(255*I.g)+","+Math.floor(255*I.b)+","+N+")"),B.fillRect(0|Z.min.x,0|Z.max.y,Z.max.x-Z.min.x|0,Z.min.y-Z.max.y|0)),Z.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,t){if(t instanceof THREE.Camera!=!1){!0===this.autoClear&&this.clear(),H.info.render.vertices=0,H.info.render.faces=0,B.setTransform(L/S,0,0,-j/M,z,M-V),B.translate(b,C),i=g.projectScene(e,t,this.sortObjects,this.sortElements),o=i.elements,n=i.lights,r=t,re.getNormalMatrix(t.matrixWorldInverse),function(){_.setRGB(0,0,0),ee.setRGB(0,0,0),te.setRGB(0,0,0);for(var e=0,t=n.length;e<t;e++){var i=n[e],o=i.color;i instanceof THREE.AmbientLight?_.add(o):i instanceof THREE.DirectionalLight?ee.add(o):i instanceof THREE.PointLight&&te.add(o)}}();for(var c=0,p=o.length;c<p;c++){var E=o[c],h=E.material;if(void 0!==h&&0!==h.opacity){if($.makeEmpty(),E instanceof THREE.RenderableSprite)(a=E).x*=b,a.y*=C,ae(a,E,h);else if(E instanceof THREE.RenderableLine)a=E.v1,s=E.v2,a.positionScreen.x*=b,a.positionScreen.y*=C,s.positionScreen.x*=b,s.positionScreen.y*=C,$.setFromPoints([a.positionScreen,s.positionScreen]),!0===Y.isIntersectionBox($)&&se(a,s,E,h);else if(E instanceof THREE.RenderableFace){if(a=E.v1,s=E.v2,l=E.v3,a.positionScreen.z<-1||a.positionScreen.z>1)continue;if(s.positionScreen.z<-1||s.positionScreen.z>1)continue;if(l.positionScreen.z<-1||l.positionScreen.z>1)continue;a.positionScreen.x*=b,a.positionScreen.y*=C,s.positionScreen.x*=b,s.positionScreen.y*=C,l.positionScreen.x*=b,l.positionScreen.y*=C,h.overdraw>0&&(me(a.positionScreen,s.positionScreen,h.overdraw),me(s.positionScreen,l.positionScreen,h.overdraw),me(l.positionScreen,a.positionScreen,h.overdraw)),$.setFromPoints([a.positionScreen,s.positionScreen,l.positionScreen]),!0===Y.isIntersectionBox($)&&le(a,s,l,0,1,2,E,h)}Z.union($)}}B.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.")}}}});