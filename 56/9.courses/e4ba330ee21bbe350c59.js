webpackJsonp([9],Array(366).concat([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Instance=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in a)return a.value;var s=a.get;if(void 0!==s)return s.call(i)},l=n(462),u=i(l),h=n(449),p=i(h),d=n(576),f=i(d),v=n(571),b=i(v);t.Instance=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.init.apply(e,arguments),e}return s(t,e),r(t,[{key:"frame0",value:function(){function e(){if(i.scene3D.scene.onPointerObservable.add(n,BABYLON.PointerEventTypes.POINTERDOUBLETAP),i.scene3D.scene.activeCamera){i.scene3D.scene.activeCamera.upperBetaLimit=1.45,i.scene3D.setPointersButtons([0]),TweenMax.to([i.scene3D.scene.getMeshByName("yusai01"),i.scene3D.scene.getMeshByName("yusai02")],1,{visibility:.01});var e=i.children[i.children.length-1].children[2];e.addEventListener(TouchEvent.TAP,function(){2==e.currentFrame?TweenMax.to([i.scene3D.scene.getMeshByName("yusai01"),i.scene3D.scene.getMeshByName("yusai02")],1,{visibility:.01}):TweenMax.to([i.scene3D.scene.getMeshByName("yusai01"),i.scene3D.scene.getMeshByName("yusai02")],1,{visibility:1})});var a=i.children[i.children.length-1].children[1];a.addEventListener(TouchEvent.TAP,function(){2==a.currentFrame?TweenMax.to([i.scene3D.scene.getMeshByName("yusai01"),i.scene3D.scene.getMeshByName("yusai02")],1,{visibility:1}):TweenMax.to([i.scene3D.scene.getMeshByName("yusai01"),i.scene3D.scene.getMeshByName("yusai02")],1,{visibility:.01})}),t()}}function t(){i.timeline.setPlay(!0),i.timeline.on(b.default.event.ON_PLAYING,function(e){i.scene3D.animationManager.setProgress(e.time)}),i.timeline.on(b.default.event.ON_COMPLETE,function(){i.timeline.reset(),i.timeline.setPlay(!0)})}function n(){i.children[i.children.length-1].children[1].gotoAndStop(0),i.children[i.children.length-1].children[2].gotoAndStop(0),i.scene3D.menuData[1].data.flag=!0,i.scene3D.menuData[2].data.flag=!0}var i=this;u.default.apply(this,[{config:{plugins:[Object.assign(BABYLON.plugins.ObserveWireframe,{data:{color:16711680,wireframeAlpha:.05,nameFilter:/.*/,bindAnnotationToMesh:!0}})],func:{loaded:e},mesh:{pickableFilter:/^0/},camera:{alpha:3.17,beta:1.45}},models:[{url:f.default.animation_01,menu:[{event:p.default.science3D.SHOW_INTRODUCE,data:"鱼用鳃呼吸，靠鳍运动。",type:0},{event:p.default.science3D.SHOW_MESH,type:1,data:{meshName:"yusai01",addMeshName:"yusai02",index:1,flag:!0}},{event:p.default.science3D.SHOW_MESH,type:2,data:{meshName:"weiqi",addMeshName:"tunqi",index:2,flag:!0}}]}]}]),i.bottomMenu.bar.visible=!1,i.bottomMenu.bar.interactive=!1,i.bottomMenu.x=i.cloneBtn0.x,b.default.init(i.timeline,{speed:5})}},{key:"start",value:function(){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this).call(this),this.gotoStep("frame0")}}]),t}(nb.stem.STEMMain)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";e.exports={event:{SCENE_CREATION_COMPLETE:"creationComplete",annotation:{CLICK_TIP:"event.annotation.clickTip"}},sprite:{ANNOTATION:"annotation"},action:{ANNOTATION:"annotation",ANNOTATION_CLICK_TRIGGER:"annotationClickTrigger"},data:{ANNOTATION_SIZE:50},TWEEN_TIMER:1.2,camera:{FOV:.8,MIN_ZOOM_FOV:.6,ARC_CAMERA:"arcCamera",VR_ARC_CAMERA:"vrArcCamera",FREE_CAMERA:"freeCamera",VR_FREE_CAMERA:"vrFreeCamera",ANAGLYPH_CAMERA:"anaglyphCamera",STEREOSCOPIC_CAMERA:"stereoscopicCamera",ALPHA:3.1,BETA:1},render:{ORDINARY:"ordinary",WIREFRAME:"wireframe"},setting:{RENDER:"val-render",CAMERA:"val-camera",ANNOTATION:"val-annotation",SPEED:"val-speed"},commands:{UPDATE_ANNOTATION_DATA:"updateAnnotationData",PLAY_ANIMATION_COMMAND:"playAnimation",SET_ANNOTATION_VISIBLE:"setAnnotationVisible",UPDATE_SETTING_PANEL:"updateSettingPanel",CHECK_ENV:"checkEvn",CONFIGURE_MATERIAL:"configureMaterial",CONFIGURE_PIPELINE:"configurePipeline",SET_CAMERA_CONTROL:"setCameraControl",DISPOSE:"dispose",OBSERVE_MESH_BY_FRAME:"observeMeshByFrame",OBSERVE_MESH_BY_RORATE:"observeMeshByRotate",PIXI_PLUGIN:"pixiPlugin",SCENE_CAPTURE:"sceneCapture"},config:{URI_PREFIX:""},isDebug:!1,UID:function(){return"id_"+Math.random().toString().substr(2,10)}}},function(e,t,n){"use strict";e.exports={CommandManager:n(480),ICommand:n(454)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={toggle:{STATUS:"event.toggle.status"},radioButton:{CHANGE:"event.radioButton.change",TAPACTIVE:"event.radioButton.tap_active"},science3D:{SHOW_INTRODUCE:"event.science3D.show_introduce",SHOW_MESH:"event.science3D.show_mesh",PLAY_ANIMATION:"event.science3D.play_animation"},popup:{CLOSE:"event.popup.close"},experimentStep:{CHANGE:"event.experimentStep.change"}}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return a(e,null,[{key:"projectToScreen",value:function(e,t){var n=t.getEngine(),i=t.activeCamera.viewport.toGlobal(n.getRenderWidth(),n.getRenderHeight());return BABYLON.Vector3.Project(e,BABYLON.Matrix.Identity(),t.getTransformMatrix(),i)}},{key:"projectToPixiSprite",value:function(t,n,i,a,o){a=a||instance.W,o=o||instance.H;var s=e.projectToScreen(t,n);return e.canvasPointToPixiSprite(s,i,n.getEngine().getRenderingCanvas(),a,o)}},{key:"canvasPointToPixiSprite",value:function(e,t,n,i,a){i=i||instance.W,a=a||instance.H;var o={x:e.x/n.width*i,y:e.y/n.height*a};return t.toLocal(o)}},{key:"getShortRotation",value:function(e,t){return e-t>Math.PI?e-2*Math.PI:e-t<-Math.PI?e+2*Math.PI:e}},{key:"hasAnimation",value:function(e){var t=e.Animatables;if(!t)return!1;for(var n=0;n<t.length;n++){if(t[n].getAnimations().length>0)return!0}return!1}},{key:"convertTextToHTML",value:function(e){return e.replace(/"/gi,"&quot;")}},{key:"convertHTMLToText",value:function(e){return e.replace(/&quot;/gi,'"')}}]),e}();e.exports=o},,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in a)return a.value;var s=a.get;if(void 0!==s)return s.call(i)},c=void 0,l=void 0,u=n(447),h=n(450),p=n(475),d=void 0,f=0,v=void 0,b=void 0,m=function(e){function t(e){i(this,t);var n=e.scene;if(!c){var o=e.data.annotation.spriteURL||"assets/textures/annotation.png";c=new BABYLON.SpriteManager(u.sprite.ANNOTATION,u.config.URI_PREFIX+o,20,64,n),c.isPickable=!0,c.renderingGroupId=1,l=new BABYLON.SpriteManager(u.sprite.ANNOTATION,u.config.URI_PREFIX+o,20,64,n)}var s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"annotation",c));s.babylonScene=e,s.isPickable=!0,s.color.a=.3,s.actionManager=e.getActionManagerByName(u.action.ANNOTATION),s.configData=e.data.annotation;var r=s.configData;if(s.bottomSprite=new BABYLON.Sprite("annotationTop",l),"threeDLine"===r.type){v||(v=new BABYLON.StandardMaterial("lineMaterial",n),v.alpha=r.line.alpha,v.diffuseColor=BABYLON.Color3.FromHexString("#"+r.line.color.toString(16)),b=new BABYLON.StandardMaterial("lineMaterialTop",n),b.alpha=Math.min(r.line.alpha/3,.1),b.diffuseColor=v.diffuseColor),s.lineMeshName="line"+ ++f;var h=[new BABYLON.Vector3(0,0,0),new BABYLON.Vector3(0,0,0)];s.lineMesh=BABYLON.Mesh.CreateTube("tube",h,.01,6,null,null,n,!0),s.lineMesh.material=v,s.lineMeshTopRender=BABYLON.Mesh.CreateTube("tubeTopRender",h,.01,6,null,null,n,!0),s.lineMeshTopRender.material=b,s.lineMeshTopRender.renderingGroupId=1,s.pos3D=[new BABYLON.Vector3(0,0,0),new BABYLON.Vector3(0,0,0)],s.pos2D=[{x:0,y:0},{x:0,y:0}],s.tip2D=new p(e),r.tipParent.addChild(s.tip2D)}return s}return o(t,e),s(t,[{key:"zoomIn",value:function(e){var t=this.getSceneData(),n={radius:t.camera.radius,alpha:t.camera.alpha%(2*Math.PI),beta:t.camera.beta%(2*Math.PI)};if(Object.assign(n,e),this.babylonScene.lookAtVector(t.camera.target,n),t.pickedMesh){var i=this.babylonScene.scene,a=t.pickedMesh,o=i.getMeshByID(a.id)||i.getMeshByName(a.name);o&&o.actionManager&&o.actionManager.processTrigger(u.action.ANNOTATION_CLICK_TRIGGER,{source:o})}var s=t.aniProgress;this.babylonScene.animationManager.tweenToProgress(s,e),(this.babylonScene.data.annotation.showAnnotationPanel||u.isDebug)&&this.showTip()}},{key:"showTip",value:function(){if(d&&d.hideTip(),this.tip)this.tip.fadeIn();else{var e="标题",t="请输入说明文字",n='<div class="annotation visible" data-hotspot="1">\n\t\t\t\t\t        <div class="tooltip visible reverse-x">\n\t\t\t\t                <div class="tooltip-content padded">\n\t\t\t\t                    <div class="edition">\n\t\t\t                            <input class="title" placeholder="'+e+'" maxlength="64" required="">\n\t\t\t                            <textarea class="description" placeholder="'+t+'" maxlength="1024" rows="2"></textarea>\n\t\t\t\t                    </div>\n\t\t\t\t                </div>\n\t\t\t\t\t        </div>\n\t\t\t\t\t    </div>';this.tip=$(n);var i=$("body"),a=$(".babylon-viewer");0===$(".babylon-viewer").length&&(i.append('<div class="babylon-viewer"></div>'),a=$(".babylon-viewer")),a.append(this.tip),this._sceneData&&(e=this._sceneData.title,t=this._sceneData.description,e=h.convertHTMLToText(e),this.tip.find(".title").val(e),this.tip.find(".description").val(t))}d=this}},{key:"getSceneData",value:function(){if(!this.tip)return this._sceneData;var e=this.tip.find(".title").val(),t=this.tip.find(".description").val();return""!==e&&(this._sceneData.title=e),""!==t&&(this._sceneData.description=t),this._sceneData}},{key:"setSceneData",value:function(e){this._sceneData=e,this.position.copyFrom(e.position),this.bottomSprite.position.copyFrom(e.position),this.tip2D&&this.tip2D.updateText(e.title)}},{key:"hideTip",value:function(){this.tip.fadeOut()}},{key:"takeSceneSnapshot",value:function(e){var t=this.actionManager.getScene().activeCamera,n=t.getTarget(),i=this.babylonScene.animationManager;this.setSceneData({camera:{radius:t.radius,target:{x:n.x,y:n.y,z:n.z},alpha:t.alpha,beta:t.beta},title:"标题",description:"请输入文字",position:{x:this.position.x,y:this.position.y,z:this.position.z},pickedMesh:e,aniProgress:i.getProgress()})}},{key:"updateTip",value:function(){if(this.bottomSprite.size=this.size,this.tip&&"block"===this.tip.css("display")){var e=h.projectToScreen(this.position,this.actionManager.getScene());this.tip.css("left",e.x+240),this.tip.css("top",e.y-12)}if(this.lineMesh){var t=.001*this.distanceOfCamera*this.configData.line.thickness,n=[this.position,this.pos3D[0]];this.lineMesh=BABYLON.MeshBuilder.CreateTube(null,{path:n,radius:t,instance:this.lineMesh}),this.lineMeshTopRender=BABYLON.MeshBuilder.CreateTube(null,{path:n,radius:t,instance:this.lineMeshTopRender}),this.tip2D.render(this.pos2D);var i=this._sceneData.title,a=i.split(":");u.shiftDown?this.tip2D.updateText(i):this.tip2D.updateText(a[a.length-1])}}},{key:"dispose",value:function(){this.lineMesh&&(r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this),this.bottomSprite.dispose(),this.tip&&this.tip.remove(),this.tip2D&&(this.tip2D.dispose(),this.lineMesh.material=null,this.lineMeshTopRender.material=null,this.lineMeshTopRender.dispose(),this.lineMesh.dispose(),delete this.lineMesh,delete this.lineMeshTopRender,delete this.tip2D))}}],[{key:"clearData",value:function(){v=null,c=null}},{key:"UpdateSpriteRenderData",value:function(e){if(0!==e.length){var t=e[0].babylonScene;if("threeDLine"===t.data.annotation.type){var n=t.scene,i=n.getEngine(),a=n.activeCamera,o=i.getRenderWidth()/2,s=i.getRenderHeight()/2;if(t.defaultTarget){var r=h.projectToScreen(t.defaultTarget,n);o=r.x,s=r.y}var c=[[],[],[],[]];e.forEach(function(e){var t=h.projectToScreen(e.position,n),i=t.x>o?1:0,a=(t.y<s?1:0)<<1;c[i|a].push(e),t=h.canvasPointToPixiSprite(t,instance.stage,n.getEngine().getRenderingCanvas()),e.pos2D[0]=t});var l=n.activeCamera.position;c.forEach(function(e,t){for(var i=e.length,o=0;o<e.length;o++){var s=e[o],r=0==(1&t)?-1:1,c=t>>1==0?-1:1,u=s.configData.line.type||"default",p=void 0;switch(u){case"default":p=Math.PI/2/(i+1)*(o+1);break;case"random":p=Math.random()*Math.PI*2;break;case"horizontal":p=0;break;case"vertical":p=Math.PI/2}var d=BABYLON.Vector3.Distance(s.position,a.position),f=2*Math.cos(p)*r,v=2*Math.sin(p)*c,b=BABYLON.AbstractMesh._lookAtVectorCache;l.subtractToRef(s.position,b);var m=Math.sqrt(b.x*b.x+b.z*b.z),y=-Math.atan2(b.z,b.x)-Math.PI/2,g=Math.atan2(b.y,m),A=BABYLON.Matrix.RotationYawPitchRoll(y,g,0);A.setTranslation(s.position);var O=new BABYLON.Vector3(0,0,0);BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(f,v,0,A,O);var x=new BABYLON.Vector3(0,0,0);BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(f+.4*r,v,0,A,x),O=BABYLON.Vector3.Lerp(s.position,O,.1*d*s.configData.line.scale);for(var M=[O,x],E=0;E<s.pos3D.length;E++){var w=M[E];s.pos3D[E]&&(w.x=s.pos3D[E].x+(w.x-s.pos3D[E].x)/7,w.y=s.pos3D[E].y+(w.y-s.pos3D[E].y)/7,w.z=s.pos3D[E].z+(w.z-s.pos3D[E].z)/7,s.pos3D[E]=w)}var B=h.projectToPixiSprite(s.pos3D[0],n,instance.stage);s.pos2D[1]=B,s.distanceOfCamera=d}})}}}},{key:"SetAnnotationVisible",value:function(e){if(c){c.sprites&&(e?(c.tempSprites&&(c.sprites=c.tempSprites,delete c.tempSprites),l.tempSprites&&(l.sprites=l.tempSprites,delete l.tempSprites)):(c.tempSprites=c.sprites,c.sprites=[],l.tempSprites=l.sprites,l.sprites=[]))}}},{key:"lastTip",get:function(){return d},set:function(e){d=e}}]),t}(BABYLON.Sprite);e.exports=m},function(e,t,n){"use strict";(function(t){if(t.BABYLON){var i=n(447);BABYLON.DragUtil=n(467),BABYLON.RotateUtil=n(468),BABYLON.plugins={ObserveWireframe:{command:i.commands.OBSERVE_MESH_BY_FRAME,data:{}},ObserveAround:{command:i.commands.OBSERVE_MESH_BY_RORATE,data:{}}},BABYLON.RotateHelperMesh=n(469),BABYLON.RotateControl=n(471),e.exports={BabylonScene:n(473),ConstName:i}}else e.exports={addExpressApp:n(512)}}).call(t,n(1))},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return a(e,[{key:"execute",value:function(){throw"必须重写该方法"}}]),e}();e.exports=o},function(e,t,n){"use strict";var i={utf8:{stringToBytes:function(e){return i.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(i.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}};e.exports=i},function(e,t,n){"use strict";function i(e){var t=void 0===e?"undefined":a(e);return null!=e&&("object"==t||"function"==t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=i},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=n(501),o="object"==("undefined"==typeof self?"undefined":i(self))&&self&&self.Object===Object&&self,s=a||o||Function("return this")();e.exports=s},function(e,t,n){"use strict";var i=n(457),a=i.Symbol;e.exports=a},,function(e,t,n){(function(e){function n(e,t){for(var n=0,i=e.length-1;i>=0;i--){var a=e[i];"."===a?e.splice(i,1):".."===a?(e.splice(i,1),n++):n&&(e.splice(i,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function i(e,t){if(e.filter)return e.filter(t);for(var n=[],i=0;i<e.length;i++)t(e[i],i,e)&&n.push(e[i]);return n}var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(e){return a.exec(e).slice(1)};t.resolve=function(){for(var t="",a=!1,o=arguments.length-1;o>=-1&&!a;o--){var s=o>=0?arguments[o]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(t=s+"/"+t,a="/"===s.charAt(0))}return t=n(i(t.split("/"),function(e){return!!e}),!a).join("/"),(a?"/":"")+t||"."},t.normalize=function(e){var a=t.isAbsolute(e),o="/"===s(e,-1);return e=n(i(e.split("/"),function(e){return!!e}),!a).join("/"),e||a||(e="."),e&&o&&(e+="/"),(a?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(i(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,n){function i(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var a=i(e.split("/")),o=i(n.split("/")),s=Math.min(a.length,o.length),r=s,c=0;c<s;c++)if(a[c]!==o[c]){r=c;break}for(var l=[],c=r;c<a.length;c++)l.push("..");return l=l.concat(o.slice(r)),l.join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){var t=o(e),n=t[0],i=t[1];return n||i?(i&&(i=i.substr(0,i.length-1)),n+i):"."},t.basename=function(e,t){var n=o(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){return o(e)[3]};var s="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(t,n(8))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(e){var t=parseInt(this.name.replace(r,""));if(c.activeButton===this)return void c.emit(a.default.radioButton.TAPACTIVE,{index:t});c.check&&!1===c.check()||(c.activeButton&&c.activeButton.gotoAndStop(0),c.setActiveIndex(t))}function n(e){0===this.currentFrame&&this.gotoAndStop(1)}function i(e){1===this.currentFrame&&this.gotoAndStop(0)}var s=this,r=e?e.name:"icon";this.activeButton=null;for(var c=this,l=0;l<o;l++){if("break"===function(e){var a=s[r+e];if(!a)return"break";if(a.buttonMode=!0,a.gotoAndStop){if(a.totalFrames>3)throw"图标动画的帧数不能超过3帧，请调整结构或者联系作者"}else a.gotoAndStop=function(e){a.component&&a.component.gotoAndStop&&a.component.gotoAndStop(e)},Object.defineProperty(a,"currentFrame",{get:function(){return a.component.currentFrame},set:function(e){a.component.currentFrame=e}}),Object.defineProperty(a,"totalFrames",{get:function(){return a.component.totalFrames}});window.NBGesture?NBGesture.addGesture(a,NBGesture.gesture.TAP,t):a.addEventListener(TouchEvent.TOUCH_END,t),NBGesture.addGesture,3===a.totalFrames&&(a.addEventListener(MouseEvent.MOUSE_OVER,n),a.addEventListener(MouseEvent.MOUSE_OUT,i))}(l))break}this.getActiveButton=function(){return c.activeButton},this.setActiveIndex=function(e){var t=s[r+e];if(!t)return c.activeButton&&c.activeButton.gotoAndStop(0),c.activeButton=null,void c.emit(a.default.radioButton.CHANGE,{index:-1});c.activeButton=t;var n=c.activeButton.totalFrames;void 0===n&&(n=c.activeButton.component.totalFrames),c.activeButton.gotoAndStop(n-1),c.emit(a.default.radioButton.CHANGE,{index:e})}};var i=n(449),a=function(e){return e&&e.__esModule?e:{default:e}}(i),o=100},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(){L=(-instance.H+nb.canvasHeight)/2,n()}function n(){var e=Power1.easeInOut;1===_.bar.currentFrame?(TweenMax.to(_,.5,{y:nb.canvasHeight+10-L,ease:e}),TweenMax.to(T,.5,{y:-100+L})):(TweenMax.to(_,.5,{y:S-L,ease:e}),TweenMax.to(T,.5,{y:L}))}function i(){E.setActiveIndex(-1),E.children[R].currentFrame=0}function a(t){if(k=!0,1!=e.models.length||!N){if(N=!0,!e.models[t.index])return void console.log("配置文件不完整!");x.popup.visible=!1,B=e.models[t.index];var n=B.url;u(!1),x.scene3D.disposeSceneObjects();var i=e.models[t.index],a=i.radius,o=i.alpha,s=i.beta;void 0!==a&&(x.scene3D.defaultRadius=a),void 0!==o&&(g.camera.alpha=o),void 0!==s&&(g.camera.beta=s),x.scene3D.loadMesh(n,g),p();var c=e.models[t.index].menu;for(x.scene3D.scene.activeCamera,x.scene3D.menuData=c;E.children.length;){var l=E.getChildAt(0);delete E[l.name],E.removeChildAt(0)}for(var h=0;h<c.length;h++){var d=M[c[h].type||h%M.length].clone();E.addChild(d),d.name="icon"+h,E[d.name]=d,d.x=0,d.y=70*-h}r.default.apply(E);var f=E.getBounds();E.x=instance.W-(instance.W-nb.canvasWidth)/2-100,E.y=nb.canvasHeight-f.height}}function s(e){var t=e.index,n=B.menu[t];if(n){switch(n.event){case l.default.science3D.SHOW_INTRODUCE:x.popup.visible?x.popup.visible=!1:(R=t,x.popup.x=x.popup.defaultPosition.x,x.popup.y=x.popup.defaultPosition.y,x.popup.visible=!0,x.popup.setContent(n.data),n.lineHeight&&(x.popup.children[1].style.lineHeight=n.lineHeight,x.popup.children[1].updateText()),n.font&&(x.popup.children[1].style.font=n.font,x.popup.children[1].updateText()));break;case l.default.science3D.SHOW_MESH:var i=n.data;D.push(E.children[i.index]),Y.push(i);var a=x.scene3D.scene.getMeshByName(i.meshName);if(i.addMeshName){x.scene3D.scene.getMeshByName(i.addMeshName).bindMesh=a}if(i.arrMesh&&i.arrMesh.forEach(function(e){x.scene3D.scene.getMeshByName(e).bindMesh=a}),i.isHide)a.isVisible=!0,I.push(a);else{var o=!0,s=!1,r=void 0;try{for(var c,u=I[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h=c.value;h&&(h.isVisible=!1)}}catch(e){s=!0,r=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw r}}}var p=a.actionManager,d=BABYLON.Mesh.MinMax([a]),f=BABYLON.Vector3.Center(d.min,d.max);if(Y[Y.length-1].flag){var v=!0,b=!1,m=void 0;try{for(var g,A=D[Symbol.iterator]();!(v=(g=A.next()).done);v=!0){g.value.gotoAndStop(0)}}catch(e){b=!0,m=e}finally{try{!v&&A.return&&A.return()}finally{if(b)throw m}}D[D.length-1].gotoAndStop(2);var O=!0,M=!1,w=void 0;try{for(var T,C=Y[Symbol.iterator]();!(O=(T=C.next()).done);O=!0){T.value.flag=!0}}catch(e){M=!0,w=e}finally{try{!O&&C.return&&C.return()}finally{if(M)throw w}}p.processTrigger(BABYLON.ActionManager.OnDoublePickTrigger,{source:a,pickedPoint:f,ignoreCameraDistance:!0}),p.processTrigger(y.action.ANNOTATION_CLICK_TRIGGER,{source:a}),i.isRatotion&"undefined"!=i.alpha&&(TweenMax.to(x.scene3D.scene.activeCamera,1.5,{alpha:i.alpha}),"undefined"!=i.beta&&TweenMax.to(x.scene3D.scene.activeCamera,1.5,{beta:i.beta})),i.radius&&TweenMax.to(x.scene3D.scene.activeCamera,1.5,{radius:i.radius}),i.flag=!i.flag}else{var P=n.data,_=!0,S=!1,L=void 0;try{for(var N,j=D[Symbol.iterator]();!(_=(N=j.next()).done);_=!0){N.value.gotoAndStop(0)}}catch(e){S=!0,L=e}finally{try{!_&&j.return&&j.return()}finally{if(S)throw L}}var X=!0,F=!1,Z=void 0;try{for(var z,V=Y[Symbol.iterator]();!(X=(z=V.next()).done);X=!0){z.value.flag=!0}}catch(e){F=!0,Z=e}finally{try{!X&&V.return&&V.return()}finally{if(F)throw Z}}var U=!0,H=!1,G=void 0;try{for(var W,$=I[Symbol.iterator]();!(U=(W=$.next()).done);U=!0){var Q=W.value;Q&&(Q.isVisible=!1)}}catch(e){H=!0,G=e}finally{try{!U&&$.return&&$.return()}finally{if(H)throw G}}I=[],D=[],Y=[],x.scene3D.resetSceneMesh&&x.scene3D.resetSceneMesh(),x.scene3D.zoomOut(),P.backRadius&&TweenMax.to(x.scene3D.scene.activeCamera,1.5,{radius:P.backRadius}),P.backAlpha&&P.backBeta&&TweenMax.to(x.scene3D.scene.activeCamera,1.5,{radius:P.backBeta})}break;case l.default.science3D.PLAY_ANIMATION:var K=n.speed||1;void 0===n.autoPlay&&void 0===n.noPlay?(x.scene3D.zoomOut(),k||(void 0===n.tween?x.scene3D.scene.babylonScene.animationManager.tweenToProgress(0):x.scene3D.scene.babylonScene.animationManager.setProgress(0)),x.scene3D.execute(y.commands.PLAY_ANIMATION_COMMAND,{reset:k,play:k,timeScale:K})):void 0===n.noPlay&&(n.autoPlay?(x.scene3D.execute(y.commands.PLAY_ANIMATION_COMMAND,{reset:n.autoPlay,play:!0,timeScale:K}),x.scene3D.scene.babylonScene.animationManager.setProgress(0)):x.scene3D.execute(y.commands.PLAY_ANIMATION_COMMAND,{reset:n.autoPlay,play:!1,timeScale:0}),n.autoPlay=!n.autoPlay),k=!k}"function"==typeof n.onChange&&n.onChange({index:t,bool:!!E.children[n.data.index].currentFrame}),this.emit("btnChange",e)}}function c(e){var t=this,n=e["clear-color"]?e["clear-color"]:994597887;e=Object.assign({"clear-color":n,interactiveCanvas:window.instance?window.instance.canvas:null},e),void 0===e.importScene&&(e.importScene=!0),e.emitter=this,e.canvas=instance.get3DCanvas(),BABYLON.Database.IDBStorageEnabled=!1,g=Object.assign({},e),this.scene3D=new m(e);var i=this.scene3D.scene.interactiveCanvas;if(i.style.touchAction="none",i.style.pointerEvents="all",document.body.setAttribute("onselectstart","event.returnValue=false"),document.body.setAttribute("oncontextmenu","window.event.returnValue=false"),this.scene3D.setPointersButtons=function(e){t.scene3D.scene.activeCamera.inputs.attached.pointers.buttons=e},this.scene3D.fouceInMesh=function(e,t){var n=e.actionManager,i=BABYLON.Mesh.MinMax([e]),a=BABYLON.Vector3.Center(i.min,i.max);n.processTrigger(BABYLON.ActionManager.OnDoublePickTrigger,{source:e,pickedPoint:a});var o=t.alpha,s=t.beta,r=t.radius;TweenMax.to(b.scene.activeCamera,1.5,{alpha:o,beta:s,radius:r})},this.scene3D.addSkybox=function(e){var t=new BABYLON.Texture(e,this.scene),n=new BABYLON.StandardMaterial("sphericalMat",this.scene);n.emissiveTexture=t,n.diffuseColor.set(0,0,0),n.specularColor.set(0,0,0);var i=BABYLON.MeshBuilder.CreateSphere("SkySphere",{segments:32,sideOrientation:BABYLON.Mesh.BACKSIDE},this.scene);return i.scaling.set(5e3,5e3,5e3),i.rotation.z=-.5,i.infiniteDistance=!0,i.renderingGroupId=0,i.material=n,i},this.scene3D.addSun=function(e,t){e.isVisible=!1;var n=new BABYLON.StandardMaterial("sunMaterial",this.scene);n.emissiveTexture=new BABYLON.Texture(t,this.scene),n.backFaceCulling=!0,n.diffuseColor.set(0,0,0),n.specularColor.set(0,0,0);var i=BABYLON.Mesh.CreateSphere("sun",20,7,this.scene);return i.material=n,i.position=e.position,new BABYLON.HighlightLayer("hl1",this.scene).addMesh(i,new BABYLON.Color3(1,1,0)),i},this.scene3D.addLight=function(e){new BABYLON.HemisphericLight("HemiLight0",new BABYLON.Vector3(0,1,0),this.scene).intensity=e,new BABYLON.HemisphericLight("HemiLight1",new BABYLON.Vector3(0,-1,0),this.scene).intensity=e},e.addBackground){var a=function(e){var t=/[^\.\/\\]+.[^\.]+$/gi,n=e.match(t)[0];return{path:e.split(n)[0],name:n}},o=function(e,t){var n=M.getLightByName("Spot001");n.position.set(5*l,10*l,-10*l),n.direction.set(-.5,-1,1),n.intensity=3,n.shadowAngleScale=.2,n.intensityMode=1,n.exponent=100,n.angle=5,BABYLON.Mesh.CreateSphere("lightSphere",16,1,M).position=n.position;var i=new BABYLON.ShadowGenerator(1024,n);window.shadowGenerator=i,n.shadowMaxZ=300,n.shadowMinZ=10,i.setDarkness(.1),i.useContactHardeningShadow=!0,i.getShadowMap().renderList=e,t.receiveShadows=!0},s=e.addBackground,r=s.cameraConf,c=s.modelUrl,l=s.modelScale;r=Object.assign({upperBetaLimit:1.57,lowerRadiusLimit:3,upperRadiusLimit:10,defaultRadius:4,defaultTarget:new BABYLON.Vector3(.022303105205297435,.3469105437092268,.015726989612069697),modelScale:1,playAnimation:!1},r);var u=r,h=u.upperBetaLimit,p=u.lowerRadiusLimit,d=u.upperRadiusLimit,f=u.defaultRadius,v=u.defaultTarget,y=u.playAnimation,O=x.scene3D,M=O.scene;x.scene3D.initBackground=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};M.activeCamera.upperBetaLimit=h,M.activeCamera.lowerRadiusLimit=p,M.activeCamera.upperRadiusLimit=d,this.defaultRadius=f,this.defaultTarget=v,M.getLightByName("Sky001")&&(M.getLightByName("Sky001").intensity=t.s0?t.s0:.5),M.getLightByName("Sky002")&&(M.getLightByName("Sky002").intensity=.6),M.getLightByName("Omni001")&&(M.getLightByName("Omni001").intensity=t.s1?t.s1:.3);var n=t.changeName?M.getMeshByName(t.changeName):M.getMeshByName("pSphere1");n.scaling.set(l,l,l),this.zoomOut(),t.modelUrl&&(c=t.modelUrl);var i=a(c);BABYLON.SceneLoader.ImportMesh("",i.path,i.name,M,function(i){i.forEach(function(e){e.actionManager=new BABYLON.ActionManager(M)}),y||O.animationManager.pause(),t.addShadow&&o(i,n),e&&e(),x.emit("backgroundLoaded",i)})}}this.addDrag=A}function u(e,t){O=e,f(t)}function p(){var e=document.createElement("div");$(e).addClass("loading"),$(e).css({position:"absolute",top:"50%",left:"50%",marginLeft:"-29px",marginTop:"-39px",textAlign:"center",width:"58px",height:"78px"}),$(e).html(' \n        <div class="outer" style = "">\n            <img class = \'img\' src = '+v.default+' style = "display: block; margin-bottom: 5px; width: 58px; height: 50px"/>\n            <label class="inner" style = "color: #fff;">0%</label>\n        <div>\n            '),0===$(".loading").length&&$(document.body).append($(e))}function f(e){e=e||0;var t=parseInt(100*e)+"%";$(".inner").html(t),1===e&&$(".loading").remove()}function A(e,t,n){function i(i){var a={x:i.event.clientX,y:i.event.clientY};u=o.createPickingRay(a.x,a.y);var s=u.intersectsMesh(t);if(s.hit){var r=h.pickedPoint,c=s.pickedPoint,l=void 0;l=e.parent?e.parent.getWorldMatrix().clone().invert():BABYLON.Matrix.Identity(),r=BABYLON.Vector3.TransformCoordinates(r,l),c=BABYLON.Vector3.TransformCoordinates(c,l);var p=r.subtract(c);n||e.position.subtractInPlace(p),h=s,x.emit("dragMove",{mesh:e,dv:p})}}function a(){o.onPointerObservable.remove(r),o.onPointerObservable.remove(c),r=c=null,s.execute(y.commands.SET_CAMERA_CONTROL,{enabled:!0}),x.emit("stopDrag",{mesh:e})}t.setEnabled(!1),t.isPickable=!1;var o=e.getScene(),s=o.babylonScene,r=void 0,c=void 0,l=void 0,u=void 0,h=void 0;e.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickDownTrigger,function(n){r||(l={x:n.pointerX,y:n.pointerY},u=o.createPickingRay(l.x,l.y),h=u.intersectsMesh(t),h.hit&&(x.emit("startDrag",{mesh:e}),s.execute(y.commands.SET_CAMERA_CONTROL,{enabled:!1}),r=o.onPointerObservable.add(i,BABYLON.PointerEventTypes.POINTERMOVE),c=o.onPointerObservable.add(a,BABYLON.PointerEventTypes.POINTERUP)))}))}var O=!1,x=this,M=[],E=new PIXI.Container,w=Object.assign({},e.config);this.btnComponent=E;var B=void 0;E.on(l.default.radioButton.CHANGE,s);var T=this.title;this.popup.on(l.default.popup.CLOSE,i),h.default.apply(this.popup),d.default.apply(this.popup.closeBtn),this.popup.visible=!1,this.popup.defaultPosition={x:this.popup.x,y:this.popup.y},this.addChild(E);for(var C=0;C<100;C++){var P=this["cloneBtn"+C];if(!P)break;M.push(P),P.visible=!1}if(!M.length)throw"请配置cloneBtnX按钮";var _=this.bottomMenu;o.default.apply(_);var S=_.y;_.addEventListener(l.default.radioButton.CHANGE,a),_.check=function(){return!1===x.scene3D.isLoading||x.scene3D.disposeLoadingObjects()},w&&w.func?Object.assign(w.func,{loading:u}):w.func={loading:u},w&&w.camera&&(w.camera=Object.assign({},e.config.camera)),c.apply(x,[Object.assign({callback:{sceneCreationComplete:function(){_.setActiveIndex(0)}}},w)]),_.bar.buttonMode=!0;var L=0;NBGesture.addGesture(_.bar,NBGesture.gesture.TAP,function(){_.bar.gotoAndStop(!_.bar.currentFrame),n()}),window.addEventListener("resize",t),_.bar.currentFrame=0,t();var N=!1,k=!0,Y=[],R=void 0,D=[],I=[]};var a=n(461),o=i(a),s=n(463),r=i(s),c=n(449),l=i(c),u=n(464),h=i(u),p=n(465),d=i(p),f=n(466),v=i(f),m=n(453).BabylonScene,y=n(453).ConstName,g=void 0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(e){if(c!==this&&(!l.check||!1!==l.check())){c&&c.gotoAndStop(0);var t=parseInt(this.name.replace(r,""));l.setActiveIndex(t)}}function n(e){0===this.currentFrame&&this.gotoAndStop(1)}function i(e){1===this.currentFrame&&this.gotoAndStop(0)}for(var s=this,r=e?e.name:"icon",c=null,l=this,u=0;u<o;u++){if("break"===function(e){var a=s[r+e];if(!a)return"break";if(a.buttonMode=!0,a.gotoAndStop){if(a.totalFrames>3)throw"图标动画的帧数不能超过3帧，请调整结构或者联系作者"}else a.gotoAndStop=function(e){a.component&&a.component.gotoAndStop&&a.component.gotoAndStop(e)},Object.defineProperty(a,"currentFrame",{get:function(){return a.component.currentFrame},set:function(e){a.component.currentFrame=e}}),Object.defineProperty(a,"totalFrames",{get:function(){return a.component.totalFrames}});window.NBGesture?NBGesture.addGesture(a,NBGesture.gesture.TAP,t):a.addEventListener(TouchEvent.TOUCH_END,t),3===a.totalFrames&&(a.addEventListener(MouseEvent.MOUSE_OVER,n),a.addEventListener(MouseEvent.MOUSE_OUT,i))}(u))break}this.getActiveButton=function(){return c},this.setActiveIndex=function(e){var t=s[r+e];if(!t)return c&&c.gotoAndStop(0),c=null,void l.emit(a.default.radioButton.CHANGE,{index:-1});c=t;var n=c.totalFrames;void 0===n&&(n=c.component.totalFrames),c.currentFrame===c.totalFrames-1?c.gotoAndStop(0):c.gotoAndStop(n-1),c=null,l.emit(a.default.radioButton.CHANGE,{index:e})}};var i=n(449),a=function(e){return e&&e.__esModule?e:{default:e}}(i),o=100},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(e){o.visible=!1,o.emit(a.default.popup.CLOSE)}var n=this,i=this.closeBtn,o=this;i&&i.addEventListener(TouchEvent.TAP,t),NBDrag.addDrag(this),this.on(NBDrag.event.DRAG_MOVE,function(){n.y=n.y<0?0:n.y>720-n.height?720-n.height:n.y,n.x=n.x<0?0:n.x>1280-n.width?1280-n.width:n.x}),this.setContent=function(e){o.intro.text=e||"",o.intro.style.font="20px 'Microsoft YaHei'"},this.setContent(e),o.intro.style.lineHeight=50};var i=n(449),a=function(e){return e&&e.__esModule?e:{default:e}}(i)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(){this.gotoAndStop(this.totalFrames-1)}function t(){this.gotoAndStop(0)}function n(e){0===this.currentFrame&&this.gotoAndStop(1)}function i(e){1===this.currentFrame&&this.gotoAndStop(0)}this.buttonMode=!0,this.addEventListener(TouchEvent.TOUCH_BEGIN,e),this.addEventListener(TouchEvent.TOUCH_END,t),this.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,t),3===this.totalFrames&&(this.addEventListener(MouseEvent.MOUSE_OVER,n),this.addEventListener(MouseEvent.MOUSE_OUT,i))}},function(e,t,n){e.exports=n.p+"275438e7a3d916821817a4545dd47635.gif"},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(447),s=function(){function e(){i(this,e)}return a(e,null,[{key:"dragOnVector",value:function(e,t,n){}},{key:"dragOnPlane",value:function(e,t){function n(n){var i={x:n.event.clientX,y:n.event.clientY};u=a.createPickingRay(i.x,i.y);var o=u.intersectsMesh(t);if(o.hit){var s=h.pickedPoint,r=o.pickedPoint,c=void 0;c=e.parent?e.parent.getWorldMatrix().clone().invert():BABYLON.Matrix.Identity(),s=BABYLON.Vector3.TransformCoordinates(s,c),r=BABYLON.Vector3.TransformCoordinates(r,c);var l=s.subtract(r);e.position.subtractInPlace(l),h=o}}function i(){a.onPointerObservable.remove(r),a.onPointerObservable.remove(c),r=c=null,s.execute(o.commands.SET_CAMERA_CONTROL,{enabled:!0})}t.setEnabled(!1),t.isPickable=!1;var a=e.getScene(),s=a.babylonScene,r=void 0,c=void 0,l=void 0,u=void 0,h=void 0,p=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickDownTrigger,function(e){r||(l={x:e.pointerX,y:e.pointerY},u=a.createPickingRay(l.x,l.y),h=u.intersectsMesh(t),h.hit&&(s.execute(o.commands.SET_CAMERA_CONTROL,{enabled:!1}),r=a.onPointerObservable.add(n,BABYLON.PointerEventTypes.POINTERMOVE),c=a.onPointerObservable.add(i,BABYLON.PointerEventTypes.POINTERUP)))});e.actionManager.registerAction(p)}}]),e}();e.exports=s},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(447),s=function(){function e(){i(this,e)}return a(e,null,[{key:"addRotate",value:function(e,t,n){function i(n){var i=c.createPickingRay(n.event.clientX,n.event.clientY),a=i.intersectsMesh(t);if(a.hit){var o=a.pickedPoint,r=s(o),l=r-m;l>Math.PI?l=2*-Math.PI+l:l<-Math.PI&&(l+=2*Math.PI);var u=e.rotation[f]-l;void 0!==v&&void 0!==b&&(u<v&&(u=v),u>b&&(u=b)),e.rotation[f]=u,m=r}}function a(){c.onPointerObservable.remove(u),c.onPointerObservable.remove(h),u=h=null,l.execute(o.commands.SET_CAMERA_CONTROL,{enabled:!0})}function s(e){var n=t.getWorldMatrix().clone().invert(),i=BABYLON.Vector3.TransformCoordinates(e,n);return Math.atan2(i.y-d.y,i.x-d.x)}function r(n){var i=e.getWorldMatrix().clone(),a=BABYLON.Vector3.TransformCoordinates(n,i),o=t.getWorldMatrix().clone().invert();return a=BABYLON.Vector3.TransformCoordinates(a,o)}n=n||{};var c=e.getScene(),l=c.babylonScene,u=void 0,h=void 0;n.pivot=n.pivot||new BABYLON.Vector3(0,0,0);var p=r(n.pivot);t.position.copyFrom(p);var d=r(n.pivot),f=n.rotateAxis||"y",v=n.startAngle,b=n.endAngle;if(void 0!==v&&void 0!==b&&v>b)throw"起始角度不能大于结束角度";t.setEnabled(!1),t.isPickable=!1;var m=void 0,y=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickDownTrigger,function(e){var n=c.createPickingRay(e.pointerX,e.pointerY),r=n.intersectsMesh(t);if(r.hit){l.execute(o.commands.SET_CAMERA_CONTROL,{enabled:!1}),u=c.onPointerObservable.add(i,BABYLON.PointerEventTypes.POINTERMOVE),h=c.onPointerObservable.add(a,BABYLON.PointerEventTypes.POINTERUP);var p=r.pickedPoint;m=s(p)}});e.actionManager.registerAction(y)}}]),e}();e.exports=s},function(e,t,n){"use strict";(function(t){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(470),o=n(447),s={FREE:0,ACTIVE:1},r={startAxis:BABYLON.Vector3.Up(),startPosition:BABYLON.Vector3.Zero(),startAxisForDisc:BABYLON.Vector3.Forward()},c=function e(n,c,l){function u(){if(f.state===s.ACTIVE){f.lastPosition=f.currentPosition,f.currentPosition=h(),f.lastRotation=f.currentRotation;var e=BABYLON.Vector3.Dot(f.currentPosition,f.startPosition)/f._config.diameter,t=BABYLON.Vector3.Dot(f.currentPosition,f.nPosition)/f._config.diameter;console.log(e,t);var n=Math.acos(e)*t/Math.abs(t);console.log(180*n/Math.PI),f.currentRotation=n;var i=f.currentRotation-f.lastRotation,a=f._state.meshRotation+i;f._config.isFree?f._state.rotation=a:f._state.rotation=Math.max(f._config.lowerAngle,Math.min(f._config.upperAngle,a)),console.log(f.targetMesh.position),f._config.callback&&f._confog.callback(f._state)}}function h(){var e=void 0,t=n.pointerX,i=n.pointerY,a=n.createPickingRay(t,i),o=a.origin,s=a.direction;if(s.normalize()===o.subtract(f._config.pivot).normalize()){var r=BABYLON.Vector3.Dot(o.subtract(f._config.pivot),f._config.axis)/f._config.axis.lengthSquare();e=o.subtract(f._config.axis.scale(r)).scale(.01)}else{var c=BABYLON.Vector3.Dot(o.subtract(f._config.pivot),f._config.axis)/BABYLON.Vector3.Dot(s,f._config.axis);e=o.add(s.scale(-c))}var l=e.subtract(f._config.pivot).normalize().scale(f._config.diameter);return BABYLON.MeshBuilder.CreateSphere("",{diameter:.1},n).position=e.clone(),l}function p(){n.babylonScene.execute(o.commands.SET_CAMERA_CONTROL,{enabled:!0}),f.startPosition=null,f.currentPosition=null,f.startRotation=null,f.currentRadius=0,f.state=s.FREE,n.unregisterBeforeRender(u)}var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};i(this,e);var f=this;f.state=s.FREE,f.startPosition=null,f.currentPosition=null,f.lastPosition=null,f.currentRadius=0,f.fromRotation=null,f.lastRotation=0,f.nPosition=null,f.targetMesh=c,f.targetMesh.controller||(f.targetMesh.controller=[]);var v=f.targetMesh.controller.length;f.targetMesh.controller.push(f),f.strtPointer=0;var b=null,m=null;if(f._config={pivot:BABYLON.Vector3.Zero(),axis:r.startAxis,isFree:!1,lowerAngle:0,upperAngle:0,diameter:1,thickness:.08,tessellation:100,callback:null},f._state={meth:f.targetMesh,rotation:0},Object.assign(f._config,d),f._config.axis.normalize(),f._discConfig={radius:(f._config.diameter-f._config.thickness)/2-.001,arc:.001,tessellation:30,sideOrientation:BABYLON.Mesh.DOUBLESIDE,updatable:!0},!f._config.axis.length)throw"Unable zero vector to rotate around!!";l&&(f._state.currentRotation=l),n.babylonScene.helperMaterial?b=n.babylonScene.helperMaterial:(b=new BABYLON.StandardMaterial("controllerMaterial",n),b.diffuseColor.set(.28235,.57647,.41176),b.alpha=.6,n.babylonScene.helperMaterial=b),n.babylonScene.drawPlaneMaterial?m=n.babylonScene.drawPlaneMaterial:(m=new BABYLON.StandardMaterial("drawMaterial",n),m.diffuseColor.set(.6,.6,.6),m.alpha=.8,m.useLogarithmicDepth=!0,n.babylonScene.drawPlaneMaterial=m);f._config.diameter,Math.max(5*f._config.thickness,.1);f.areaMesh=BABYLON.MeshBuilder.CreateCylinder(f.targetMesh.name+"Helper"+v+"Area",{height:10*f._config.thickness,diameterTop:f._config.diameter+5*f._config.thickness,diameterBottom:f._config.diameter+5*f._config.thickness,tessellation:15},n),f.areaMesh.isVisible=!0,f.areaMesh.visibility=.2;var y={diameter:f._config.diameter,thickness:f._config.thickness,tessellation:f._config.tessellation};f.flagMesh=BABYLON.MeshBuilder.CreateTorus(f.targetMesh.name+"Helper"+v+"Flag",y,n),f.flagMesh.material=b,f.flagMesh.position=f.areaMesh.position,f.flagMesh.rotation=f.areaMesh.rotation,f.flagMesh.isVisible=!0,f.flagMesh.visibility=0,f.planeMesh=BABYLON.MeshBuilder.CreatePlane(f.targetMesh.name+"Helper"+v+"Plane",{size:f._config.diameter/2,sideOrientation:BABYLON.Mesh.DOUBLESIDE},n),f.planeMesh.visibility=.1,f.discMesh=BABYLON.MeshBuilder.CreateDisc(f.targetMesh.Name+"Helper"+v+"Sector",f._discConfig,n),f.discMesh.material=b,f.discMesh.visibility=0,f.dRotate=Math.acos(BABYLON.Vector3.Dot(r.startAxis,f._config.axis)),f.dRotate>=.001&&(f.tAxis=BABYLON.Vector3.Cross(r.startAxis,f._config.axis).normalize(),f.flagMesh.rotate(f.tAxis,f.dRotate),f.areaMesh.rotate(f.tAxis,f.dRotate),console.log("rAxis",f._config.axis)),f.discRotate=Math.acos(BABYLON.Vector3.Dot(r.startAxisForDisc,f._config.axis)),console.log("----\x3e rotation",f.discRotate),f.discRotate>=1e-5&&(f.discAxis=BABYLON.Vector3.Cross(r.startAxisForDisc,f._config.axis).normalize(),f.discMesh.rotate(f.discAxis,f.discRotate),f.planeMesh.rotate(f.discAxis,f.discRotate),console.log("start: mesh, disc",r.startAxis,r.startAxisForDisc),console.log("axis, rotation",f.discAxis,f.discRotate)),f.flagMesh.position=f.areaMesh.position=f.planeMesh.position=f.discMesh.position=f._config.pivot;var g=function(e){f.flagMesh.visibility=.8,f.discMesh.visibility=0,f.state===s.ACTIVE&&p()},A=function(e){f.flagMesh.visibility=0,f.discMesh.visibility=0,f.state===s.ACTIVE&&p()},O=function(e){(f.flagMesh.visibility=1,f._discConfig.arc=.6,BABYLON.VertexData.CreateDisc(f._discConfig).applyToMesh(f.discMesh,f._discConfig.updatable),f.discMesh.visibility=1,f.state===s.FREE)&&(f.state=s.ACTIVE,n.babylonScene.execute(o.commands.SET_CAMERA_CONTROL,{enabled:!1}),n.pointerX,n.pointerY,f.startPosition=h().normalize(),f.currentPosition=f.startPosition,f.currentRotation=0,f.nPosition=BABYLON.Vector3.Cross(f._config.axis,f.startPosition).normalize(),n.registerBeforeRender(u))};f.areaMesh.actionManager=new a(n.babylonScene,{onHover:g,onOut:A,onPick:O});var x=new BABYLON.ActionManager(n);f.planeMesh.actionManager=x,d.isDebug&&(f.planeMesh.visibility=f.flagMesh.visibility=1),t.tm=f.targetMesh,t.gm=f.flagMesh,t.am=f.areaMesh,t.pm=f.planeMesh,t.dm=f.discMesh,t.mm=b};e.exports=c}).call(t,n(1))},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(e){function t(e,n){i(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.scene));return o.babylonScene=e,o.isOver=!1,o.isPick=!1,o.activities=n,o.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger,o.onPointerOver.bind(o))),o.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger,o.onPointerOut.bind(o))),o.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickDownTrigger,o.onPick.bind(o))),o.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickUpTrigger,o.onPickUp.bind(o))),o.babylonScene.scene.onPointerObservable.add(o.onPickUp.bind(o),BABYLON.PointerEventTypes.POINTERUP),o}return o(t,e),s(t,[{key:"onPointerOver",value:function(e){var t=e.source;console.log("pointer over "+t.name),this.target=t,this.isOver=!0,this.check(t,e)}},{key:"onPointerOut",value:function(e){var t=e.source;console.log("pointer out "+t.name),this.isOver=!1,this.check(t,e)}},{key:"onPick",value:function(e){var t=e.source;console.log("pick "+t.name),this.isPick=!0,this.check(t,e)}},{key:"onPickUp",value:function(e){e.source;this.isPick=!1,this.check(this.target,e)}},{key:"onLongPress",value:function(e){var t=e.source;console.log("pointer long press "+t.name)}},{key:"check",value:function(e,t){e&&(this.isPick?this.activities.onPick(t):this.isOver?this.activities.onHover(t):this.activities.onOut(t))}}]),t}(BABYLON.ActionManager);e.exports=r},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(472),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function e(t,n,a,s,r){i(this,e);var c=this;c.control=new o.default.EditControl(t,n.activeCamera,n.interactiveCanvas,a||.75,s||!1),c.control.enableRotation()};e.exports=s},function(e,t,n){"use strict";var i;!function(e){!function(e){!function(e){!function(e){var t,n=BABYLON.Axis,i=BABYLON.Color3,a=BABYLON.Mesh,o=BABYLON.MeshBuilder,s=BABYLON.Path2,r=BABYLON.Quaternion,c=BABYLON.Space,l=BABYLON.StandardMaterial,u=BABYLON.Vector3;!function(e){e[e.TRANS=0]="TRANS",e[e.ROT=1]="ROT",e[e.SCALE=2]="SCALE"}(t||(t={}));var h=function(){function e(e,t,n,i,o){var s=this;this.local=!0,this.snapT=!1,this.snapR=!1,this.transSnap=1,this.rotSnap=Math.PI/18,this.axesLen=.4,this.axesScale=1,this.visibility=.7,this.distFromCamera=2,this.toParent=new u(0,0,0),this.cameraNormal=new u(0,0,0),this.actionListener=null,this.actionStartListener=null,this.actionEndListener=null,this.pDown=!1,this.pointerIsOver=!1,this.editing=!1,this.snapRX=0,this.snapRY=0,this.snapRZ=0,this.snapTV=new u(0,0,0),this.transBy=new u(0,0,0),this.snapS=!1,this.snapSX=0,this.snapSY=0,this.snapSZ=0,this.snapSA=0,this.snapSV=new u(0,0,0),this.scaleSnap=.25,this.scale=new u(0,0,0),this.eulerian=!1,this.snapRA=0,this.cN=new u(0,0,0),this.transEnabled=!1,this.rotEnabled=!1,this.scaleEnabled=!1,this.localX=new u(0,0,0),this.localY=new u(0,0,0),this.localZ=new u(0,0,0),this.mesh=e,this.canvas=n,this.axesScale=i,this.eulerian=null!==o&&o,this.checkQuaternion(),this.scene=e.getScene(),this.mainCamera=t,this.actHist=new p(e,10),e.computeWorldMatrix(!0),this.boundingDimesion=this.getBoundingDimension(e),this.theParent=new a("EditControl",this.scene),this.theParent.rotationQuaternion=r.Identity(),this.theParent.visibility=0,this.theParent.isPickable=!1,this.createMaterials(this.scene),this.createGuideAxes(),this.guideCtl.parent=this.theParent,this.createPickPlanes(),this.pickPlanes.parent=this.theParent,this.pointerdown=function(e){return s.onPointerDown(e)},this.pointerup=function(e){return s.onPointerUp(e)},this.pointermove=function(e){return s.onPointerMove(e)},n.addEventListener("pointerdown",this.pointerdown,!1),n.addEventListener("pointerup",this.pointerup,!1),n.addEventListener("pointermove",this.pointermove,!1),this.setLocalAxes(e),this.renderer=function(){return s.renderLoopProcess()},this.scene.registerBeforeRender(this.renderer)}return e.prototype.checkQuaternion=function(){if(!this.eulerian&&(null==this.mesh.rotationQuaternion||void 0==this.mesh.rotationQuaternion))throw"Error: Eulerian is set to false but the mesh's rotationQuaternion is not set."},e.prototype.setAxesScale=function(){this.theParent.position.subtractToRef(this.mainCamera.position,this.toParent),u.FromFloatArrayToRef(this.mainCamera.getWorldMatrix().asArray(),8,this.cameraNormal);var e=u.Dot(this.toParent,this.cameraNormal)/this.cameraNormal.length(),t=e/this.distFromCamera;u.FromFloatsToRef(t,t,t,this.theParent.scaling),u.FromFloatsToRef(t,t,t,this.pALL.scaling)},e.prototype.setAxesRotation=function(){if(this.local)if(this.eulerian){var e=this.mesh.rotation;this.theParent.rotationQuaternion.copyFrom(BABYLON.Quaternion.RotationYawPitchRoll(e.y,e.x,e.z))}else this.theParent.rotationQuaternion=this.mesh.rotationQuaternion},e.prototype.renderLoopProcess=function(){this.theParent.position=this.mesh.getAbsolutePivotPoint(),this.setAxesScale(),this.setAxesRotation(),this.onPointerOver()},e.prototype.switchTo=function(e,t){e.computeWorldMatrix(!0),this.mesh=e,null!=t&&(this.eulerian=t),this.checkQuaternion(),this.setLocalAxes(e),this.actHist=new p(e,10)},e.prototype.setUndoCount=function(e){this.actHist.setCapacity(e)},e.prototype.undo=function(){var e=this.actHist.undo();this.mesh.computeWorldMatrix(!0),this.setLocalAxes(this.mesh),this.callActionStartListener(e),this.callActionListener(e),this.callActionEndListener(e)},e.prototype.redo=function(){var e=this.actHist.redo();this.mesh.computeWorldMatrix(!0),this.setLocalAxes(this.mesh),this.callActionStartListener(e),this.callActionListener(e),this.callActionEndListener(e)},e.prototype.detach=function(){this.canvas.removeEventListener("pointerdown",this.pointerdown,!1),this.canvas.removeEventListener("pointerup",this.pointerup,!1),this.canvas.removeEventListener("pointermove",this.pointermove,!1),this.scene.unregisterBeforeRender(this.renderer),this.removeAllActionListeners(),this.disposeAll()},e.prototype.disposeAll=function(){this.theParent.dispose(),this.disposeMaterials(),this.actHist=null},e.prototype.addActionListener=function(e){this.actionListener=e},e.prototype.removeActionListener=function(){this.actionListener=null},e.prototype.addActionStartListener=function(e){this.actionStartListener=e},e.prototype.removeActionStartListener=function(){this.actionStartListener=null},e.prototype.addActionEndListener=function(e){this.actionEndListener=e},e.prototype.removeActionEndListener=function(){this.actionEndListener=null},e.prototype.removeAllActionListeners=function(){this.actionListener=null,this.actionStartListener=null,this.actionEndListener=null},e.prototype.onPointerDown=function(e){var t=this;if(this.pDown=!0,0==e.button){var n=this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(e){if(t.transEnabled){if(e==t.tX||e==t.tY||e==t.tZ||e==t.tXZ||e==t.tZY||e==t.tYX||e==t.tAll)return!0}else if(t.rotEnabled){if(e==t.rX||e==t.rY||e==t.rZ||e==t.rAll)return!0}else if(t.scaleEnabled&&(e==t.sX||e==t.sY||e==t.sZ||e==t.sXZ||e==t.sZY||e==t.sYX||e==t.sAll))return!0;return!1},null,this.mainCamera);if(n.hit){this.setAxesVisiblity(0),this.axisPicked=n.pickedMesh;var i=this.axisPicked.getChildren();i.length>0?i[0].visibility=this.visibility:this.axisPicked.visibility=this.visibility;var a=this.axisPicked.name;"X"==a?this.bXaxis.visibility=1:"Y"==a?this.bYaxis.visibility=1:"Z"==a?this.bZaxis.visibility=1:"XZ"==a?(this.bXaxis.visibility=1,this.bZaxis.visibility=1):"ZY"==a?(this.bZaxis.visibility=1,this.bYaxis.visibility=1):"YX"==a?(this.bYaxis.visibility=1,this.bXaxis.visibility=1):"ALL"==a&&(this.bXaxis.visibility=1,this.bYaxis.visibility=1,this.bZaxis.visibility=1),this.setEditing(!0),this.pickPlane=this.getPickPlane(this.axisPicked),this.prevPos=this.getPosOnPickPlane(),window.setTimeout(function(e,n){return t.detachControl(e,n)},0,this.mainCamera,this.canvas)}}},e.prototype.setEditing=function(e){this.editing=e,e?(this.setActionType(),this.callActionStartListener(this.actionType)):this.callActionEndListener(this.actionType)},e.prototype.isEditing=function(){return this.editing},e.prototype.detachControl=function(e,t){var n=e,i=t;n.detachControl(i)},e.prototype.isPointerOver=function(){return this.pointerIsOver},e.prototype.onPointerOver=function(){var e=this;if(!this.pDown){var t=this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(t){if(e.transEnabled){if(t==e.tX||t==e.tY||t==e.tZ||t==e.tXZ||t==e.tZY||t==e.tYX||t==e.tAll)return!0}else if(e.rotEnabled){if(t==e.rX||t==e.rY||t==e.rZ||t==e.rAll)return!0}else if(e.scaleEnabled&&(t==e.sX||t==e.sY||t==e.sZ||t==e.sXZ||t==e.sZY||t==e.sYX||t==e.sAll))return!0;return!1},null,this.mainCamera);if(t.hit){if(t.pickedMesh!=this.prevOverMesh){if(this.pointerIsOver=!0,this.clearPrevOverMesh(),this.prevOverMesh=t.pickedMesh,this.rotEnabled)this.savedCol=this.prevOverMesh.getChildren()[0].color,this.prevOverMesh.getChildren()[0].color=i.White();else{var n=this.prevOverMesh.getChildren();n.length>0?(this.savedMat=n[0].material,n[0].material=this.whiteMat):(this.savedMat=this.prevOverMesh.material,this.prevOverMesh.material=this.whiteMat)}"X"==this.prevOverMesh.name?this.xaxis.color=i.White():"Y"==this.prevOverMesh.name?this.yaxis.color=i.White():"Z"==this.prevOverMesh.name&&(this.zaxis.color=i.White())}}else this.pointerIsOver=!1,null!=this.prevOverMesh&&(this.restoreColor(this.prevOverMesh),this.prevOverMesh=null)}},e.prototype.clearPrevOverMesh=function(){null!=this.prevOverMesh&&(this.prevOverMesh.visibility=0,this.restoreColor(this.prevOverMesh))},e.prototype.restoreColor=function(e){switch(e.name){case"X":this.xaxis.color=i.Red();break;case"Y":this.yaxis.color=i.Green();break;case"Z":this.zaxis.color=i.Blue()}if(this.rotEnabled)e.getChildren()[0].color=this.savedCol;else{var t=e.getChildren();t.length>0?t[0].material=this.savedMat:e.material=this.savedMat}},e.prototype.onPointerUp=function(e){this.pDown=!1,this.editing&&(this.mainCamera.attachControl(this.canvas),this.setEditing(!1),this.setAxesVisiblity(1),this.hideBaxis(),this.restoreColor(this.prevOverMesh),this.prevOverMesh=null,this.actHist.add(this.actionType))},e.prototype.setActionType=function(){this.transEnabled?this.actionType=t.TRANS:this.rotEnabled?this.actionType=t.ROT:this.scaleEnabled&&(this.actionType=t.SCALE)},e.prototype.callActionListener=function(e){null!=this.actionListener&&window.setTimeout(this.actionListener,0,e)},e.prototype.callActionStartListener=function(e){null!=this.actionStartListener&&window.setTimeout(this.actionStartListener,0,e)},e.prototype.callActionEndListener=function(e){null!=this.actionEndListener&&window.setTimeout(this.actionEndListener,0,e)},e.prototype.onPointerMove=function(e){if(this.pDown&&this.editing&&null!=this.prevPos){this.pickPlane=this.getPickPlane(this.axisPicked);var t=this.getPosOnPickPlane();if(null!=t){if(this.rotEnabled)this.doRotation(this.mesh,this.axisPicked,t,this.prevPos);else{var n=t.subtract(this.prevPos);if(0==n.x&&0==n.y&&0==n.z)return;this.transEnabled?this.doTranslation(n):this.scaleEnabled&&this.local&&this.doScaling(n)}this.prevPos=t,this.callActionListener(this.actionType)}}},e.prototype.getPickPlane=function(e){var t=e.name;if(this.transEnabled||this.scaleEnabled){if("XZ"==t)return this.pXZ;if("ZY"==t)return this.pZY;if("YX"==t)return this.pYX;if("ALL"==t)return this.pALL;var n=this.mesh.getWorldMatrix().clone().invert(),i=u.TransformCoordinates(this.mainCamera.position,n),a=this.mesh.scaling;if("X"===t)return Math.abs(i.y*a.y)>Math.abs(i.z*a.z)?this.pXZ:this.pYX;if("Z"===t)return Math.abs(i.y*a.y)>Math.abs(i.x*a.x)?this.pXZ:this.pZY;if("Y"===t)return Math.abs(i.z*a.z)>Math.abs(i.x*a.x)?this.pYX:this.pZY}else{if(!this.rotEnabled)return null;switch(t){case"X":return this.pZY;case"Y":return this.pXZ;case"Z":return this.pYX;default:return this.pALL}}},e.prototype.doTranslation=function(e){this.transBy.x=0,this.transBy.y=0,this.transBy.z=0;var t=this.axisPicked.name;"X"!=t&&"XZ"!=t&&"YX"!=t&&"ALL"!=t||(this.local?this.transBy.x=u.Dot(e,this.localX)/(this.localX.length()*this.mesh.scaling.x):this.transBy.x=e.x),"Y"!=t&&"ZY"!=t&&"YX"!=t&&"ALL"!=t||(this.local?this.transBy.y=u.Dot(e,this.localY)/(this.localY.length()*this.mesh.scaling.y):this.transBy.y=e.y),"Z"!=t&&"XZ"!=t&&"ZY"!=t&&"ALL"!=t||(this.local?this.transBy.z=u.Dot(e,this.localZ)/(this.localZ.length()*this.mesh.scaling.z):this.transBy.z=e.z),this.transWithSnap(this.mesh,this.transBy,this.local),this.transBoundsMin&&(this.mesh.position.x=Math.max(this.mesh.position.x,this.transBoundsMin.x),this.mesh.position.y=Math.max(this.mesh.position.y,this.transBoundsMin.y),this.mesh.position.z=Math.max(this.mesh.position.z,this.transBoundsMin.z)),this.transBoundsMax&&(this.mesh.position.x=Math.min(this.mesh.position.x,this.transBoundsMax.x),this.mesh.position.y=Math.min(this.mesh.position.y,this.transBoundsMax.y),this.mesh.position.z=Math.min(this.mesh.position.z,this.transBoundsMax.z)),this.mesh.computeWorldMatrix(!0)},e.prototype.transWithSnap=function(e,t,i){if(this.snapT){var a=!1;if(this.snapTV.addInPlace(t),Math.abs(this.snapTV.x)>this.tSnap.x/e.scaling.x&&(this.snapTV.x>0?t.x=this.tSnap.x:t.x=-this.tSnap.x,t.x=t.x/e.scaling.x,a=!0),Math.abs(this.snapTV.y)>this.tSnap.y/e.scaling.y&&(this.snapTV.y>0?t.y=this.tSnap.y:t.y=-this.tSnap.y,t.y=t.y/e.scaling.y,a=!0),Math.abs(this.snapTV.z)>this.tSnap.z/e.scaling.z&&(this.snapTV.z>0?t.z=this.tSnap.z:t.z=-this.tSnap.z,t.z=t.z/e.scaling.z,a=!0),!a)return;Math.abs(t.x)!==this.tSnap.x/e.scaling.x&&(t.x=0),Math.abs(t.y)!==this.tSnap.y/e.scaling.y&&(t.y=0),Math.abs(t.z)!==this.tSnap.z/e.scaling.z&&(t.z=0),u.FromFloatsToRef(0,0,0,this.snapTV),a=!1}i?(this.mesh.translate(n.X,t.x,c.LOCAL),this.mesh.translate(n.Y,t.y,c.LOCAL),this.mesh.translate(n.Z,t.z,c.LOCAL)):this.mesh.position.addInPlace(t)},e.prototype.doScaling=function(e){this.scale.x=0,this.scale.y=0,this.scale.z=0;var t=this.axisPicked.name;if("X"!=t&&"XZ"!=t&&"YX"!=t||(this.scale.x=u.Dot(e,this.localX)/this.localX.length()),"Y"!=t&&"ZY"!=t&&"YX"!=t||(this.scale.y=u.Dot(e,this.localY)/this.localY.length()),"Z"!=t&&"XZ"!=t&&"ZY"!=t||(this.scale.z=u.Dot(e,this.localZ)/this.localZ.length()),"ALL"==t){var n=u.Dot(e,this.mainCamera.upVector);this.scale.copyFromFloats(n,n,n)}else"XZ"==t?Math.abs(this.scale.x)>Math.abs(this.scale.z)?this.scale.z=this.scale.x:this.scale.x=this.scale.z:"ZY"==t?Math.abs(this.scale.z)>Math.abs(this.scale.y)?this.scale.y=this.scale.z:this.scale.z=this.scale.y:"YX"==t&&(Math.abs(this.scale.y)>Math.abs(this.scale.x)?this.scale.x=this.scale.y:this.scale.y=this.scale.x);var i=this.boundingDimesion;this.scale.x=this.scale.x/i.x,this.scale.y=this.scale.y/i.y,this.scale.z=this.scale.z/i.z,this.scaleWithSnap(this.mesh,this.scale),this.scaleBoundsMin&&(this.mesh.scaling.x=Math.max(this.mesh.scaling.x,this.scaleBoundsMin.x),this.mesh.scaling.y=Math.max(this.mesh.scaling.y,this.scaleBoundsMin.y),this.mesh.scaling.z=Math.max(this.mesh.scaling.z,this.scaleBoundsMin.z)),this.scaleBoundsMax&&(this.mesh.scaling.x=Math.min(this.mesh.scaling.x,this.scaleBoundsMax.x),this.mesh.scaling.y=Math.min(this.mesh.scaling.y,this.scaleBoundsMax.y),this.mesh.scaling.z=Math.min(this.mesh.scaling.z,this.scaleBoundsMax.z))},e.prototype.scaleWithSnap=function(e,t){if(this.snapS){var n=!1;if(this.snapSV.addInPlace(t),Math.abs(this.snapSV.x)>this.scaleSnap&&(t.x>0?t.x=this.scaleSnap:t.x=-this.scaleSnap,n=!0),Math.abs(this.snapSV.y)>this.scaleSnap&&(t.y>0?t.y=this.scaleSnap:t.y=-this.scaleSnap,n=!0),Math.abs(this.snapSV.z)>this.scaleSnap&&(t.z>0?t.z=this.scaleSnap:t.z=-this.scaleSnap,n=!0),!n)return;Math.abs(t.x)!==this.scaleSnap&&0!==t.x&&(t.x=0),Math.abs(t.y)!==this.scaleSnap&&0!==t.y&&(t.y=0),Math.abs(t.z)!==this.scaleSnap&&0!==t.z&&(t.z=0),u.FromFloatsToRef(0,0,0,this.snapSV),n=!1}e.scaling.addInPlace(t)},e.prototype.getBoundingDimension=function(e){var t=this.mesh.getBoundingInfo().boundingBox;return t.maximum.subtract(t.minimum)},e.prototype.refreshBoundingInfo=function(){this.boundingDimesion=this.getBoundingDimension(this.mesh)},e.prototype.doRotation=function(t,i,a,o){var s=this.cN;u.TransformNormalToRef(n.Z,this.mainCamera.getWorldMatrix(),s);var r=e.getAngle(o,a,t.getAbsolutePivotPoint(),s);i==this.rX?(this.snapR&&(this.snapRX+=r,r=0,Math.abs(this.snapRX)>=this.rotSnap&&(r=this.snapRX>0?this.rotSnap:-this.rotSnap,this.snapRX=0)),0!==r&&(this.local?(u.Dot(this.localX,s)<0&&(r*=-1),t.rotate(n.X,r,c.LOCAL)):t.rotate(new u(s.x,0,0),r,c.WORLD))):i==this.rY?(this.snapR&&(this.snapRY+=r,r=0,Math.abs(this.snapRY)>=this.rotSnap&&(r=this.snapRY>0?this.rotSnap:-this.rotSnap,this.snapRY=0)),0!==r&&(this.local?(u.Dot(this.localY,s)<0&&(r*=-1),t.rotate(n.Y,r,c.LOCAL)):t.rotate(new u(0,s.y,0),r,c.WORLD))):i==this.rZ?(this.snapR&&(this.snapRZ+=r,r=0,Math.abs(this.snapRZ)>=this.rotSnap&&(r=this.snapRZ>0?this.rotSnap:-this.rotSnap,this.snapRZ=0)),0!==r&&(this.local?(u.Dot(this.localZ,s)<0&&(r*=-1),t.rotate(n.Z,r,c.LOCAL)):t.rotate(new u(0,0,s.z),r,c.WORLD))):i==this.rAll&&(this.snapR&&(this.snapRA+=r,r=0,Math.abs(this.snapRA)>=this.rotSnap&&(r=this.snapRA>0?this.rotSnap:-this.rotSnap,this.snapRA=0)),0!==r&&t.rotate(t.position.subtract(this.mainCamera.position),r,c.WORLD)),this.setLocalAxes(this.mesh),this.eulerian&&0!=r&&(t.rotation=t.rotationQuaternion.toEulerAngles(),t.rotationQuaternion=null)},e.prototype.getPosOnPickPlane=function(){var e=this,t=this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(t){return t==e.pickPlane},null,this.mainCamera);return t.hit?t.pickedPoint:null},e.prototype.hideBaxis=function(){this.bXaxis.visibility=0,this.bYaxis.visibility=0,this.bZaxis.visibility=0},e.prototype.setAxesVisiblity=function(e){this.transEnabled&&(this.tEndX.visibility=e,this.tEndY.visibility=e,this.tEndZ.visibility=e,this.tEndXZ.visibility=e,this.tEndZY.visibility=e,this.tEndYX.visibility=e,this.tEndAll.visibility=e),this.rotEnabled&&(this.rEndX.visibility=e,this.rEndY.visibility=e,this.rEndZ.visibility=e,this.rEndAll.visibility=e),this.scaleEnabled&&(this.sEndX.visibility=e,this.sEndY.visibility=e,this.sEndZ.visibility=e,this.sEndXZ.visibility=e,this.sEndZY.visibility=e,this.sEndYX.visibility=e,this.sEndAll.visibility=e)},e.prototype.isTranslationEnabled=function(){return this.transEnabled},e.prototype.enableTranslation=function(){null==this.tX&&(this.createTransAxes(),this.tCtl.parent=this.theParent),this.clearPrevOverMesh(),this.transEnabled||(this.tEndX.visibility=this.visibility,this.tEndY.visibility=this.visibility,this.tEndZ.visibility=this.visibility,this.tEndXZ.visibility=this.visibility,this.tEndZY.visibility=this.visibility,this.tEndYX.visibility=this.visibility,this.tEndAll.visibility=this.visibility,this.transEnabled=!0,this.disableRotation(),this.disableScaling())},e.prototype.disableTranslation=function(){this.transEnabled&&(this.tEndX.visibility=0,this.tEndY.visibility=0,this.tEndZ.visibility=0,this.tEndXZ.visibility=0,this.tEndZY.visibility=0,this.tEndYX.visibility=0,this.tEndAll.visibility=0,this.transEnabled=!1)},e.prototype.isRotationEnabled=function(){return this.rotEnabled},e.prototype.returnEuler=function(e){this.eulerian=e},e.prototype.enableRotation=function(){null==this.rX&&(this.createRotAxes(),this.rCtl.parent=this.theParent),this.clearPrevOverMesh(),this.rotEnabled||(this.rEndX.visibility=this.visibility,this.rEndY.visibility=this.visibility,this.rEndZ.visibility=this.visibility,this.rEndAll.visibility=this.visibility,this.rotEnabled=!0,this.disableTranslation(),this.disableScaling())},e.prototype.disableRotation=function(){this.rotEnabled&&(this.rEndX.visibility=0,this.rEndY.visibility=0,this.rEndZ.visibility=0,this.rEndAll.visibility=0,this.rotEnabled=!1)},e.prototype.isScalingEnabled=function(){return this.scaleEnabled},e.prototype.enableScaling=function(){null==this.sX&&(this.createScaleAxes(),this.sCtl.parent=this.theParent),this.clearPrevOverMesh(),this.scaleEnabled||(this.sEndX.visibility=this.visibility,this.sEndY.visibility=this.visibility,this.sEndZ.visibility=this.visibility,this.sEndXZ.visibility=this.visibility,this.sEndZY.visibility=this.visibility,this.sEndYX.visibility=this.visibility,this.sEndAll.visibility=this.visibility,this.scaleEnabled=!0,this.disableTranslation(),this.disableRotation())},e.prototype.disableScaling=function(){this.scaleEnabled&&(this.sEndX.visibility=0,this.sEndY.visibility=0,this.sEndZ.visibility=0,this.sEndXZ.visibility=0,this.sEndZY.visibility=0,this.sEndYX.visibility=0,this.sEndAll.visibility=0,this.scaleEnabled=!1)},e.prototype.setScaleBounds=function(e,t){this.scaleBoundsMin=e||null,this.scaleBoundsMax=t||null,null!=this.scaleBoundsMin&&(0==this.scaleBoundsMin.x&&(this.scaleBoundsMin.x=1e-8),0==this.scaleBoundsMin.y&&(this.scaleBoundsMin.y=1e-8),0==this.scaleBoundsMin.z&&(this.scaleBoundsMin.z=1e-8))},e.prototype.removeScaleBounds=function(){this.scaleBoundsMin=null,this.scaleBoundsMax=null},e.prototype.setTransBounds=function(e,t){this.transBoundsMin=e||null,this.transBoundsMax=t||null},e.prototype.removeTransBounds=function(){this.transBoundsMin=null,this.transBoundsMax=null},e.prototype.setRotBounds=function(e,t){this.rotBoundsMin=e||null,this.rotBoundsMax=t||null},e.prototype.removeRotBounds=function(){this.rotBoundsMin=null,this.rotBoundsMax=null},e.prototype.createGuideAxes=function(){this.guideCtl=new a("guideCtl",this.scene),this.bXaxis=a.CreateLines("bxAxis",[new u(-100,0,0),new u(100,0,0)],this.scene),this.bYaxis=a.CreateLines("byAxis",[new u(0,-100,0),new u(0,100,0)],this.scene),this.bZaxis=a.CreateLines("bzAxis",[new u(0,0,-100),new u(0,0,100)],this.scene),this.bXaxis.isPickable=!1,this.bYaxis.isPickable=!1,this.bZaxis.isPickable=!1,this.bXaxis.parent=this.guideCtl,this.bYaxis.parent=this.guideCtl,this.bZaxis.parent=this.guideCtl,this.bXaxis.color=i.Red(),this.bYaxis.color=i.Green(),this.bZaxis.color=i.Blue(),this.hideBaxis();var e=this.axesLen*this.axesScale;this.xaxis=a.CreateLines("xAxis",[new u(0,0,0),new u(e,0,0)],this.scene),this.yaxis=a.CreateLines("yAxis",[new u(0,0,0),new u(0,e,0)],this.scene),this.zaxis=a.CreateLines("zAxis",[new u(0,0,0),new u(0,0,e)],this.scene),this.xaxis.isPickable=!1,this.yaxis.isPickable=!1,this.zaxis.isPickable=!1,this.xaxis.parent=this.guideCtl,this.yaxis.parent=this.guideCtl,this.zaxis.parent=this.guideCtl,this.xaxis.color=i.Red(),this.yaxis.color=i.Green(),this.zaxis.color=i.Blue()},e.prototype.createPickPlanes=function(){this.pALL=a.CreatePlane("pALL",5,this.scene),this.pXZ=a.CreatePlane("pXZ",5,this.scene),this.pZY=a.CreatePlane("pZY",5,this.scene),this.pYX=a.CreatePlane("pYX",5,this.scene),this.pALL.isPickable=!1,this.pXZ.isPickable=!1,this.pZY.isPickable=!1,this.pYX.isPickable=!1,this.pALL.visibility=0,this.pXZ.visibility=0,this.pZY.visibility=0,this.pYX.visibility=0,this.pALL.billboardMode=a.BILLBOARDMODE_ALL,this.pXZ.rotate(n.X,1.57),this.pZY.rotate(n.Y,1.57),this.pickPlanes=new a("pickPlanes",this.scene),this.pALL.parent=this.theParent,this.pXZ.parent=this.pickPlanes,this.pZY.parent=this.pickPlanes,this.pYX.parent=this.pickPlanes},e.prototype.createTransAxes=function(){var e=.04*this.axesScale,t=this.axesLen*this.axesScale;this.tCtl=new a("tarnsCtl",this.scene),this.tX=this.extrudeBox(e/2,t),this.tX.name="X",this.tY=this.tX.clone("Y"),this.tZ=this.tX.clone("Z"),this.tXZ=o.CreatePlane("XZ",{size:2*e},this.scene),this.tZY=this.tXZ.clone("ZY"),this.tYX=this.tXZ.clone("YX"),this.tXZ.rotation.x=1.57,this.tZY.rotation.y=-1.57,this.tXZ.position.x=e,this.tXZ.position.z=e,this.tZY.position.z=e,this.tZY.position.y=e,this.tYX.position.y=e,this.tYX.position.x=e,this.tAll=a.CreateBox("ALL",2*e,this.scene),this.tX.parent=this.tCtl,this.tY.parent=this.tCtl,this.tZ.parent=this.tCtl,this.tXZ.parent=this.tCtl,this.tZY.parent=this.tCtl,this.tYX.parent=this.tCtl,this.tAll.parent=this.tCtl,this.tX.rotation.y=1.57,this.tY.rotation.x-=1.57,this.tX.visibility=0,this.tY.visibility=0,this.tZ.visibility=0,this.tXZ.visibility=0,this.tZY.visibility=0,this.tYX.visibility=0,this.tAll.visibility=0,this.tX.isPickable=!1,this.tY.isPickable=!1,this.tZ.isPickable=!1,this.tXZ.isPickable=!1,this.tZY.isPickable=!1,this.tYX.isPickable=!1,this.tAll.isPickable=!1;var n=t/5,i=e;this.tEndX=a.CreateCylinder("tEndX",n,0,i,6,1,this.scene),this.tEndY=this.tEndX.clone("tEndY"),this.tEndZ=this.tEndX.clone("tEndZ"),this.tEndXZ=this.createTriangle("XZ",1.75*i,this.scene),this.tEndZY=this.tEndXZ.clone("ZY"),this.tEndYX=this.tEndXZ.clone("YX"),this.tEndAll=o.CreatePolyhedron("tEndAll",{type:1,size:i/2},this.scene),this.tEndX.rotation.x=1.57,this.tEndY.rotation.x=1.57,this.tEndZ.rotation.x=1.57,this.tEndXZ.rotation.x=-1.57,this.tEndZY.rotation.x=-1.57,this.tEndYX.rotation.x=-1.57,this.tEndX.parent=this.tX,this.tEndY.parent=this.tY,this.tEndZ.parent=this.tZ,this.tEndXZ.parent=this.tXZ,this.tEndZY.parent=this.tZY,this.tEndYX.parent=this.tYX,this.tEndAll.parent=this.tAll,this.tEndX.position.z=t-n/2,this.tEndY.position.z=t-n/2,this.tEndZ.position.z=t-n/2,this.tEndX.material=this.redMat,this.tEndY.material=this.greenMat,this.tEndZ.material=this.blueMat,this.tEndXZ.material=this.redMat,this.tEndZY.material=this.blueMat,this.tEndYX.material=this.greenMat,this.tEndAll.material=this.yellowMat,this.tEndX.isPickable=!1,this.tEndY.isPickable=!1,this.tEndZ.isPickable=!1,this.tEndXZ.isPickable=!1,this.tEndZY.isPickable=!1,this.tEndYX.isPickable=!1,this.tEndAll.isPickable=!1},e.prototype.createTriangle=function(e,t,n){var i=new s(t/2,-t/2).addLineTo(t/2,t/2).addLineTo(-t/2,t/2).addLineTo(t/2,-t/2);return new BABYLON.PolygonMeshBuilder(e,i,n).build()},e.prototype.createRotAxes=function(){var e=this.axesLen*this.axesScale*2;this.rCtl=new a("rotCtl",this.scene),this.rX=this.createTube(e/2,360),this.rX.name="X",this.rY=this.rX.clone("Y"),this.rZ=this.rX.clone("Z"),this.rAll=this.createTube(e/1.75,360),this.rAll.name="ALL",this.rX.parent=this.rCtl,this.rY.parent=this.rCtl,this.rZ.parent=this.rCtl,this.rAll.parent=this.pALL,this.rX.rotation.z=1.57,this.rZ.rotation.x=-1.57,this.rAll.rotation.x=1.57,this.rX.visibility=0,this.rY.visibility=0,this.rZ.visibility=0,this.rAll.visibility=0,this.rX.isPickable=!1,this.rY.isPickable=!1,this.rZ.isPickable=!1,this.rAll.isPickable=!1;var t=e;this.rEndX=this.createCircle(t/2,360,!1),this.rEndY=this.rEndX.clone(""),this.rEndZ=this.rEndX.clone(""),this.rEndAll=this.createCircle(t/1.75,360,!1),this.rEndX.parent=this.rX,this.rEndY.parent=this.rY,this.rEndZ.parent=this.rZ,this.rEndAll.parent=this.rAll,this.rEndX.color=i.Red(),this.rEndY.color=i.Green(),this.rEndZ.color=i.Blue(),this.rEndAll.color=i.Yellow(),this.rEndX.isPickable=!1,this.rEndY.isPickable=!1,this.rEndZ.isPickable=!1,this.rEndAll.isPickable=!1},e.prototype.extrudeBox=function(e,t){var n=[new u(e,e,0),new u(-e,e,0),new u(-e,-e,0),new u(e,-e,0),new u(e,e,0)],i=[new u(0,0,0),new u(0,0,t)];return a.ExtrudeShape("",n,i,1,0,2,this.scene)},e.prototype.createCircle=function(e,t,n){null===t&&(t=360);for(var i,o,s=[],r=3.14/180,c=0,l=0;l<=t;l+=10)i=e*Math.cos(l*r),o=90==l?e:270==l?-e:e*Math.sin(l*r),s[c]=new u(i,0,o),c++;if(n){e-=.04;for(var l=0;l<=t;l+=10)i=e*Math.cos(l*r),o=90==l?e:270==l?-e:e*Math.sin(l*r),s[c]=new u(i,0,o),c++}return a.CreateLines("",s,this.scene)},e.prototype.createTube=function(e,t){null===t&&(t=360);for(var n,i,o=[],s=3.14/180,r=0,c=0;c<=t;c+=30)n=e*Math.cos(c*s),i=90==c?e:270==c?-e:e*Math.sin(c*s),o[r]=new u(n,0,i),r++;return a.CreateTube("",o,.02,3,null,BABYLON.Mesh.NO_CAP,this.scene)},e.prototype.createScaleAxes=function(){var e=.04*this.axesScale,t=this.axesLen*this.axesScale;this.sCtl=new a("sCtl",this.scene),this.sX=this.extrudeBox(e/2,t),this.sX.name="X",this.sY=this.sX.clone("Y"),this.sZ=this.sX.clone("Z"),this.sXZ=o.CreatePlane("XZ",{size:2*e},this.scene),this.sZY=this.sXZ.clone("ZY"),this.sYX=this.sXZ.clone("YX"),this.sXZ.rotation.x=1.57,this.sZY.rotation.y=-1.57,this.sXZ.position.x=e,this.sXZ.position.z=e,this.sZY.position.z=e,this.sZY.position.y=e,this.sYX.position.y=e,this.sYX.position.x=e,this.sAll=a.CreateBox("ALL",2*e,this.scene),this.sX.material=this.redMat,this.sY.material=this.greenMat,this.sZ.material=this.blueMat,this.sAll.material=this.yellowMat,this.sX.parent=this.sCtl,this.sY.parent=this.sCtl,this.sZ.parent=this.sCtl,this.sAll.parent=this.sCtl,this.sXZ.parent=this.sCtl,this.sZY.parent=this.sCtl,this.sYX.parent=this.sCtl,this.sX.rotation.y=1.57,this.sY.rotation.x-=1.57,this.sX.visibility=0,this.sY.visibility=0,this.sZ.visibility=0,this.sXZ.visibility=0,this.sZY.visibility=0,this.sYX.visibility=0,this.sAll.visibility=0,this.sX.isPickable=!1,this.sY.isPickable=!1,this.sZ.isPickable=!1,this.sXZ.isPickable=!1,this.sZY.isPickable=!1,this.sYX.isPickable=!1,this.sAll.isPickable=!1;var n=e;this.sEndX=a.CreateBox("",n,this.scene),this.sEndY=this.sEndX.clone(""),this.sEndZ=this.sEndX.clone(""),this.sEndAll=o.CreatePolyhedron("sEndAll",{type:1,size:n/2},this.scene),this.sEndXZ=this.createTriangle("XZ",1.75*n,this.scene),this.sEndZY=this.sEndXZ.clone("ZY"),this.sEndYX=this.sEndXZ.clone("YX"),this.sEndXZ.rotation.x=-1.57,this.sEndZY.rotation.x=-1.57,this.sEndYX.rotation.x=-1.57,this.sEndX.parent=this.sX,this.sEndY.parent=this.sY,this.sEndZ.parent=this.sZ,this.sEndXZ.parent=this.sXZ,this.sEndZY.parent=this.sZY,this.sEndYX.parent=this.sYX,this.sEndAll.parent=this.sAll,this.sEndX.position.z=t-n/2,this.sEndY.position.z=t-n/2,this.sEndZ.position.z=t-n/2,this.sEndX.material=this.redMat,this.sEndY.material=this.greenMat,this.sEndZ.material=this.blueMat,this.sEndXZ.material=this.redMat,this.sEndZY.material=this.blueMat,this.sEndYX.material=this.greenMat,this.sEndAll.material=this.yellowMat,this.sEndX.isPickable=!1,this.sEndY.isPickable=!1,this.sEndZ.isPickable=!1,this.sEndXZ.isPickable=!1,this.sEndZY.isPickable=!1,this.sEndYX.isPickable=!1,this.sEndAll.isPickable=!1},e.prototype.setLocalAxes=function(e){var t=e.getWorldMatrix();u.FromFloatArrayToRef(t.asArray(),0,this.localX),u.FromFloatArrayToRef(t.asArray(),4,this.localY),u.FromFloatArrayToRef(t.asArray(),8,this.localZ)},e.prototype.setLocal=function(e){this.local!=e&&(this.local=e,e||(this.theParent.rotationQuaternion=r.Identity()))},e.prototype.isLocal=function(){return this.local},e.prototype.setTransSnap=function(e){this.snapT=e},e.prototype.setRotSnap=function(e){this.snapR=e},e.prototype.setScaleSnap=function(e){this.snapS=e},e.prototype.setTransSnapValue=function(e){this.tSnap=new u(e,e,e),this.transSnap=e},e.prototype.setRotSnapValue=function(e){this.rotSnap=e},e.prototype.setScaleSnapValue=function(e){this.scaleSnap=e},e.getAngle=function(e,t,n,i){var a=e.subtract(n),o=t.subtract(n),s=u.Cross(a,o),r=Math.asin(s.length()/(a.length()*o.length()));return u.Dot(s,i)<0&&(r*=-1),r},e.prototype.createMaterials=function(t){this.redMat=e.getStandardMaterial("redMat",i.Red(),t),this.greenMat=e.getStandardMaterial("greenMat",i.Green(),t),this.blueMat=e.getStandardMaterial("blueMat",i.Blue(),t),this.whiteMat=e.getStandardMaterial("whiteMat",i.White(),t),this.yellowMat=e.getStandardMaterial("whiteMat",i.Yellow(),t)},e.prototype.disposeMaterials=function(){this.redMat.dispose(),this.greenMat.dispose(),this.blueMat.dispose(),this.whiteMat.dispose(),this.yellowMat.dispose()},e.getStandardMaterial=function(e,t,n){var a=new l(e,n);return a.emissiveColor=t,a.diffuseColor=i.Black(),a.specularColor=i.Black(),a.backFaceCulling=!1,a},e}();e.EditControl=h;var p=function(){function e(e,t){this.lastMax=10,this.acts=new Array,this.last=-1,this.current=-1,this.mesh=e,this.lastMax=t-1,this.add()}return e.prototype.setCapacity=function(e){if(0==e)return void console.error("capacity should be more than zero");this.lastMax=e-1,this.last=-1,this.current=-1,this.acts=new Array,this.add()},e.prototype.add=function(e){void 0===e&&(e=null);var t=new d(this.mesh,e);this.current<this.last&&(this.acts.splice(this.current+1),this.last=this.current),this.last==this.lastMax?(this.acts.shift(),this.acts.push(t)):(this.acts.push(t),this.last++,this.current++)},e.prototype.undo=function(){if(this.current>0){var e=this.acts[this.current].getActionType();return this.current--,this.acts[this.current].perform(this.mesh),e}},e.prototype.redo=function(){if(this.current<this.last)return this.current++,this.acts[this.current].perform(this.mesh),this.acts[this.current].getActionType()},e}();e.ActHist=p;var d=function(){function e(e,t){this.p=e.position.clone(),null==e.rotationQuaternion?(this.rQ=null,this.rE=e.rotation.clone()):(this.rQ=e.rotationQuaternion.clone(),this.rE=null),this.s=e.scaling.clone(),this.at=t}return e.prototype.getActionType=function(){return this.at},e.prototype.perform=function(e){e.position.copyFrom(this.p),null==e.rotationQuaternion?null!=this.rE?e.rotation.copyFrom(this.rE):e.rotation.copyFrom(this.rQ.toEulerAngles()):null!=this.rQ?e.rotationQuaternion.copyFrom(this.rQ):e.rotationQuaternion.copyFrom(r.RotationYawPitchRoll(this.rE.y,this.rE.x,this.rE.z)),e.scaling.copyFrom(this.s)},e}();e.Act=d}(e.component||(e.component={}))}(e.babylonjs||(e.babylonjs={}))}(e.ssatguru||(e.ssatguru={}))}(i||(i={})),e.exports=i.ssatguru.babylonjs.component},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(447),s=o.TWEEN_TIMER,r=BABYLON.Vector3,c=BABYLON.Mesh,l=n(474),u=n(476),h=n(477),p=n(478),d=n(452),f=n(479),v=n(448).CommandManager,b=n(481),m=(n(496),n(499)),y=n(450),g=n(508),A=n(509);BABYLON.Epsilon=1e-5,BABYLON.SceneLoader.ShowLoadingScreen=!1;var O=function(){function e(t){i(this,e),this.setData(t),this.defaultTarget=new BABYLON.Vector3(0,0,0),this.isLoading=!1,this.renderAnnotation=!0;var n=this;if(this._httpLoadingSet=new Set,this._resize=m(function(){n.scene&&n.scene.getEngine&&n.scene.getEngine().resize()},300,{maxWait:3e3}),window.addEventListener("resize",this._resize),this.scene=this.createScene(),this.scene instanceof A)return this.scene.loadMesh(t["model-url"]),void setTimeout(function(){n.data.callback.sceneCreationComplete&&n.data.callback.sceneCreationComplete.call()},0);"string"==typeof t.tipURL?$.getJSON(t.config.URI_PREFIX+t.tipURL,function(e){t.tips=e,n.initCore()}).fail(function(){t.tips=[],n.initCore()}):setTimeout(function(){n.initCore()},0),window.b=this}return a(e,[{key:"setData",value:function(e){if(this.data=e,e.config=Object.assign(o.config,e.config),e.func=e.func||{},e.camera=e.camera||{isDefault:!0},void 0===e.camera.alpha&&(e.camera.alpha=o.camera.ALPHA),void 0===e.camera.beta&&(e.camera.beta=o.camera.BETA),this.renderingCanvas=e.canvas,e.tips)throw"tips 已废弃，请使用tipURL代替";if(e.animation||(e.animation={autoPlay:!1}),e["write-tip-url"])throw"write-tip-url 已废弃，请使用tipURL代替";void 0===e.importScene&&(e.importScene=!1),e.callback||(this.data.callback={}),e.annotation||(e.annotation={visible:!0}),"threeDLine"===e.annotation.type&&(e.annotation.line=Object.assign({color:16777215,scale:1,alpha:1,thickness:1},e.annotation.line),e.annotation.visible=!0)}},{key:"initCore",value:function(){if(this.data){var e=this.data.emitter;this.updateEmitter(e),this.commandManager=new v(this),new b(this.commandManager),this.animationManager=new f(this);var t=n(510);this.player=new t(this,this.data),this.loadMesh(),this.execute(o.commands.CHECK_ENV).then(function(){_this.execute(o.commands.SET_ANNOTATION_VISIBLE,!0)}).catch(function(){}),this.execute(o.commands.PIXI_PLUGIN),this.data.interactiveCanvas&&this.updateInteractiveCanvas(this.data.interactiveCanvas),e&&e.emit(o.event.SCENE_CREATION_COMPLETE),this.data.callback.sceneCreationComplete&&this.data.callback.sceneCreationComplete.call()}}},{key:"updateEmitter",value:function(e){e&&e.on&&(this.renderFunc=this.render.bind(this),e.on(this.data.emitterTrigger||"update",this.renderFunc))}},{key:"render",value:function(){var e=this.scene;if(e){var t=e.getEngine();t.beginFrame();var n=e.activeCamera;if(n){if(Math.abs(n.inertialRadiusOffset)>15&&(n.inertialRadiusOffset=n.inertialRadiusOffset/Math.abs(n.inertialRadiusOffset)*15),n.target){var i=BABYLON.Vector3.Distance(n.position,n.target);if(n.inertialRadiusOffset>0&&i<10){var a=(i-.1)/9.9,s=n.inertialRadiusOffset;n.inertialRadiusOffset*=Math.pow(a,.7),isNaN(n.inertialRadiusOffset)&&(n.inertialRadiusOffset=s)}}void 0!==n.targetRadius&&(n.targetRadius=Math.min(Math.max(n.lowerRadiusLimit||0,n.targetRadius),n.upperRadiusLimit||n.targetRadius),Math.abs(n.targetRadius-n.radius)>.1?n.radius+=.15*(n.targetRadius-n.radius):delete n.targetRadius);var c=this.retrieveSprites(o.sprite.ANNOTATION);c&&(d.UpdateSpriteRenderData(c),c.forEach(function(e){var t=r.Distance(e.position,n.position);e.size=t/o.data.ANNOTATION_SIZE,e.updateTip()}));var l=this.focusingManager;l&&l.tempSprites.forEach(function(e){var t=r.Distance(e.position,n.position);e.size=t*e.tsize*.2}),this.scene.render(),this.player.update(),t.endFrame()}}}},{key:"disposeLoadingObjects",value:function(){return this._httpLoadingSet.forEach(function(e){e.abort()}),this._httpLoadingSet.size>0&&(this._httpLoadingSet.clear(),!0)}},{key:"disposeSceneObjects",value:function(){if(this.scene&&!(this.scene instanceof A)){delete this.defaultRadius,this.disposeLoadingObjects();for(var e=this.scene.meshes;e.length;)e[0].dispose(!0);var t=this.scene.lights.concat();for(var n in t){var i=t[n];i.nbLight||i.dispose()}var a=this.scene.cameras.concat();for(var o in a){var s=a[o];s.nbCamera||s.dispose()}this.scene.sprite;this.scene.spriteManagers.forEach(function(e){if(e.tempSprites){for(var t=0;t<e.tempSprites.length;t++)e.tempSprites[t].dispose();e.tempSprites.length=0}else for(;e.sprites[0];)e.sprites[0].dispose()}),d.clearData()}}},{key:"loadMesh",value:function(e,t){function n(e){var n=e;if(e instanceof BABYLON.Scene){if(e.activeCamera){var i=e.activeCamera.position,a=c.MinMax(e.meshes),l=u.defaultTarget=p?BABYLON.Vector3.Center(a.min,a.max):u.defaultTarget||BABYLON.Vector3.Zero(),h=r.Distance(i,l),d=i.subtract(l);if(void 0===u.data.camera.alpha){var f=Math.atan2(d.z,d.x);u.data.camera.alpha=f}if(void 0===u.data.camera.beta){var v=Math.acos(d.y/h);u.data.camera.beta=v}}n=e.meshes}u.updateCamera(o.camera.ARC_CAMERA),u.updateCameraVision(n),n.forEach(function(e){e.isPickable=!0,e.checkCollisions=!0,e.isImported=!0,e.actionManager=new g(u),e.material&&(e.material.backFaceCulling=!1,e.material.subMaterials&&e.material.subMaterials.forEach(function(e){e.backFaceCulling=!1}))}),u.updateTips();var b=u.data.annotation.visible;if(o.isDebug&&(b=!0),u.execute(o.commands.SET_ANNOTATION_VISIBLE,b),u.execute(o.commands.CONFIGURE_MATERIAL,u.data),u.execute(o.commands.CONFIGURE_PIPELINE,u.data),u.setLoading(!1),u.animationManager.pause(),u.animationManager.updateAnimatables(),y.hasAnimation(u.scene)?(u.player.showAnimationSetting(!0),u.execute(o.commands.PLAY_ANIMATION_COMMAND,u.data.animation.autoPlay)):u.player.showAnimationSetting(!1),t["clear-color"]||u.data["clear-color"]){var m=t["clear-color"]?t["clear-color"]:u.data["clear-color"];u.scene.clearColor=BABYLON.Color4.FromHexString("#"+m.toString(16))}else u.scene.clearColor=new BABYLON.Color4(0,0,0,1);if(u.scene.getEngine().resize(),u.minMax){var A=u.scene.activeCamera,O=r.Distance(u.minMax.min,u.minMax.max);A.defaultDistance=O;var x=u.data.camera.lowerRadiusLimit,M=u.data.camera.upperRadiusLimit;A.lowerRadiusLimit=void 0!==x?x:O/4,A.upperRadiusLimit=void 0!==M?M:4*O}s(),t.loaded&&t.loaded(e)}function i(e){var t=e.currentTarget;u._httpLoadingSet.add(t);var n=e.loaded/e.total;u.setLoading(!0,n),1===n&&u._httpLoadingSet.delete(t)}function a(e,t,n){console.error(t),console.error(n)}function s(){u.data.func.loaded&&u.data.func.loaded(u.scene),new l(u),u.data.plugins&&u.data.plugins.forEach(function(e){u.execute(e.command,e.data)})}t=t||{};var u=this,h=e||this.data["model-url"],p=e?!!t.importScene:this.data.importScene;if(this.scene instanceof A)return void this.scene.loadMesh(h);if(!h)return console.warn("没有传入 model-url"),void s();this.setLoading(!0);var d=h.lastIndexOf("/"),f=h.substr(0,d+1),v=h.substr(d+1);p?BABYLON.SceneLoader.Append(f,v,this.scene,n,i,a):BABYLON.SceneLoader.ImportMesh("",f,v,this.scene,n,i,a)}},{key:"createScene",value:function(){var e=void 0,t=this.data.canvas;if(t||(t=document.createElement("canvas"),t.width=window.innerWidth,t.height=window.innerHeight,t.style.touchAction="none",document.body.append(t)),!t.engine){try{e=new BABYLON.Engine(t,!0)}catch(e){if("WebGL not supported"===e.message)return new A(this)}t.engine=e}var n=new BABYLON.Scene(e);if(n.babylonScene=this,n.interactiveCanvas=t,this.scene=n,n.preventDefaultOnPointerDown=!1,this.updateInteractiveCanvas(this.data.interactiveCanvas),!this.data.importScene){new BABYLON.HemisphericLight("ambient",BABYLON.Vector3.Up(),n).nbLight=!0}if(this.data.light)if("default"===this.data.light.name)new BABYLON.DirectionalLight("defaultDir0",new BABYLON.Vector3(0,-1,0),n),new BABYLON.DirectionalLight("defaultDir1",new BABYLON.Vector3(0,1,0),n);else if("around"===this.data.light.name)for(var i=0;i<3;i++){var a=Math.cos(i/3*Math.PI*2),o=Math.sin(i/3*Math.PI*2);new BABYLON.DirectionalLight("around"+i,new BABYLON.Vector3(a,o,0),n)}this.engine=e;var s=new h(this);n.actionManager=s;var r=this.data.skybox;if(r){var c=void 0;c=/\.hdr$/.test(r.texture)?new BABYLON.HDRCubeTexture(r.texture,n,256):new BABYLON.CubeTexture(r.texture,n,null,!1,null,null,null,void 0,!0),c.gammaSpace=!1;n.createDefaultSkybox(c,r.pbr,r.scale||1e3,void 0===r.blur?.3:r.blur).isPickable=!1}n.activeCamera;return n}},{key:"updateTips",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.retrieveSprites(o.sprite.ANNOTATION).concat();i&&i.forEach(function(e){e.dispose()});var a=this.data.tips;a&&a.forEach(function(i){var a=i.title,o=a.split(":"),s=void 0;if(o.length>1&&e&&(s=o[0],e.test(s))){return void new d(t,t.data.annotation).setSceneData(i)}if(!1===n){new d(t,t.data.annotation).setSceneData(i)}})}},{key:"setTipsInteractive",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.retrieveSprites(o.sprite.ANNOTATION).concat();t&&t.forEach(function(t){var n=t.tip2D,i=n.text,a=n.graphics;i.interactive=a.interactive=e})}},{key:"updateCameraVision",value:function(e){e=e||this.scene.meshes;var t=c.MinMax(e),n=this.scene.activeCamera;this.minMax=t;var i=this.getCameraInitRadius(this.minMax);n.radius=this.defaultRadius=this.defaultRadius||i,n.wheelPrecision=400/n.radius,n.radius*=6.18,this.defaultTarget=BABYLON.Vector3.Center(t.min,t.max),this.zoomOut()}},{key:"getCameraInitRadius",value:function(e){return 1.2*r.Distance(e.min,e.max)}},{key:"setLoading",value:function(e,t){this.isLoading=e,this.data&&this.data.func.loading&&this.data.func.loading(e,t)}},{key:"lookAtVector",value:function(e,t){t=t||{};var n=this.scene,i=e,a=n.activeCamera,r=this.getEaseFunc(),c=a.target;if(TweenMax.to(this,t.duration||s,{ease:this.getEaseFunc(),onUpdate:function(){var e=r.getRatio(this.progress());if(c){var n=new BABYLON.Vector3(c.x+(i.x-c.x)*e,c.y+(i.y-c.y)*e,c.z+(i.z-c.z)*e);a.setTarget(n)}t&&void 0!==t.alpha&&(a.alpha=y.getShortRotation(a.alpha,t.alpha))}}),t&&void 0!==t.alpha){a.alpha%=2*Math.PI,a.beta%=2*Math.PI,void 0!==t.alpha&&(a.alpha=y.getShortRotation(a.alpha,t.alpha));var l=o.camera.FOV,u=o.camera.MIN_ZOOM_FOV,h=Math.abs(t.alpha-a.alpha),p=h/Math.PI,d=(1-p)*u,f={ease:r,onStart:function(){},onUpdate:function(){var e=this.progress(),t=void 0;t=e<.5?l+(d-l)*Sine.easeInOut.getRatio(2*e)*p:l+(d-l)*Sine.easeInOut.getRatio(2*(1-e))*p,a.fov=t}};Object.assign(f,t),TweenMax.to(a,f.duration||s,f)}}},{key:"setMeshesVisible",value:function(e,t){var n=2,i=0;t&&(n=void 0===t.timer?2:t.timer,i=void 0===t.display?0:t.display);var a=this.scene.meshes,o=void 0;o=e instanceof RegExp?e:new RegExp(e);for(var s=[],r=0;r<a.length;r++)o.test(a[r].name)&&s.push(a[r].name);for(var c=[],l=0;l<s.length;l++)c.push(this.scene.getMeshByName(s[l]));TweenMax.to(c,n,{ease:Sine.easeInOut,visibility:i})}},{key:"retrieveSprites",value:function(e){var t=this.getSpriteManagerByName(e);return t?t.tempSprites||t.sprites:[]}},{key:"getSpriteManagerByName",value:function(e){for(var t=this.scene.spriteManagers,n=0;n<t.length;n++)if(t[n].name===e)return t[n]}},{key:"lookAtSpriteByName",value:function(e,t){for(var n=this.retrieveSprites(o.sprite.ANNOTATION),i=0;i<n.length;i++){var a=n[i],s=a.getSceneData(),r=s.title,c=r.split(":");if((r=c[c.length-1])===e){a.zoomIn(t),this.emitterEvent(o.event.annotation.CLICK_TIP,s);break}}}},{key:"emitterEvent",value:function(e,t){this.data.emitter&&this.data.emitter.emit&&this.data.emitter.emit(e,t)}},{key:"zoomOut",value:function(e){this.lookAtVector(this.defaultTarget);var t=this,n=this.scene.activeCamera.alpha=this.scene.activeCamera.alpha%(2*Math.PI),i=this.scene.activeCamera.beta=this.scene.activeCamera.beta%(2*Math.PI),a=t.data.camera.alpha,o=t.data.camera.beta;TweenMax.to(this.scene.activeCamera,s,{radius:this.defaultRadius,ease:this.getEaseFunc(),onComplete:function(){e&&e()},alpha:y.getShortRotation(a,n),beta:y.getShortRotation(o,i)})}},{key:"getEaseFunc",value:function(){return Power2.easeInOut}},{key:"getActionManagerByName",value:function(e){if(void 0===this.actionMap&&(this.actionMap={}),e===o.action.ANNOTATION)return void 0===this.actionMap[o.action.ANNOTATION]&&(this.actionMap[o.action.ANNOTATION]=new u(this)),this.actionMap[o.action.ANNOTATION]}},{key:"setAnnotationVisible",value:function(e){this.renderAnnotation=e,d.SetAnnotationVisible(e)}},{key:"updateCamera",value:function(e){this._cameraMap||(this._cameraMap={});var t=this._cameraMap,n=this.scene;if(!n.activeCamera||t[e]!==n.activeCamera){var i=new BABYLON.Vector3(0,0,0);this.execute(o.commands.SET_CAMERA_CONTROL,{enabled:!1});var a=void 0,r=void 0,l=void 0;if(void 0===this.minMax&&n.meshes.length>0){var u=c.MinMax(n.meshes);this.minMax=u,this.defaultTarget=BABYLON.Vector3.Center(u.min,u.max)}if(void 0===t[e]){if(e===o.camera.ARC_CAMERA){var h=this.getCameraInitRadius(this.minMax);a=new BABYLON.ArcRotateCamera("rotateCamera",1.4,3.1,6.18*h,i,n),a.inputs.attached.pointers.buttons=[0,2],a.lowerRadiusLimit=.1,a.wheelPrecision=40,a.minZ=.05,a.noRotationConstraint=!1,a._useCtrlForPanning=!1}else if(e===o.camera.VR_ARC_CAMERA){a=new BABYLON.VRDeviceOrientationArcRotateCamera("vrCamera",0,60/180*Math.PI,1,i,n);var p=BABYLON.Vector3.Distance(this.minMax.min,this.minMax.max);r=this.defaultTarget.clone().add(new BABYLON.Vector3(.707*p,0,.707*p)),l=this.defaultTarget}else if(e===o.camera.FREE_CAMERA){a=new BABYLON.FreeCamera("freeCamera",i,n);var d=a.inputs.attached.keyboard;d.keysUp.push("W".charCodeAt(0)),d.keysDown.push("S".charCodeAt(0)),d.keysLeft.push("A".charCodeAt(0)),d.keysRight.push("D".charCodeAt(0));var f=BABYLON.Vector3.Distance(this.minMax.min,this.minMax.max);r=this.defaultTarget.clone().add(new BABYLON.Vector3(.5*f,0,.5*f)),l=this.defaultTarget}else if(e===o.camera.VR_FREE_CAMERA){a=new BABYLON.VRDeviceOrientationFreeCamera("vrFreeCamera",i,n);var v=a.inputs.attached.keyboard;v.keysUp.push("W".charCodeAt(0)),v.keysDown.push("S".charCodeAt(0)),v.keysLeft.push("A".charCodeAt(0)),v.keysRight.push("D".charCodeAt(0));var b=BABYLON.Vector3.Distance(this.minMax.min,this.minMax.max);r=this.defaultTarget.clone().add(new BABYLON.Vector3(.5*b,0,.5*b)),l=this.defaultTarget}else if(e===o.camera.ANAGLYPH_CAMERA){var m=n.activeCamera.alpha,y=n.activeCamera.beta,g=n.activeCamera.radius;a=new BABYLON.AnaglyphArcRotateCamera("anaglyphCamera",m,y,g,BABYLON.Vector3.Zero(),0,n),a.inputs.attached.pointers.buttons=[0,2],a.lowerRadiusLimit=.1,a.wheelPrecision=40,a.minZ=.05}else{if(e!==o.camera.STEREOSCOPIC_CAMERA)return;var A=n.activeCamera.alpha,O=n.activeCamera.beta,x=n.activeCamera.radius;a=new BABYLON.StereoscopicArcRotateCamera("stereoscopicCamera",A,O,x,BABYLON.Vector3.Zero(),0,!1,n)}t[e]={camera:a,position:r,cameraTarget:l},a.nbCamera=!0}else{var M=t[e];a=M.camera,r=M.cameraPosition,l=M.cameraTarget}i=new BABYLON.Vector3(0,0,0),e===o.camera.ARC_CAMERA&&(a._useCtrlForPanning=!1);var E=this.scene.activeCamera;if(E&&"string"!=typeof E.position.x&&E.nbCamera){for(var w in t)if(t[w].camera===n.activeCamera){t[w].cameraPosition=E.position.clone(),t[w].cameraTarget=this.defaultTarget;break}a.setPosition?a.setPosition(E.position):a.position.copyFrom(E.position)}else void 0!==a.alpha&&(a.alpha=Math.random()*Math.PI,a.beta=Math.random()*Math.PI);r&&i.copyFrom(r);a.target&&a.target.clone();TweenMax.to(a.position,s,{x:i.x,y:i.y,z:i.z,onUpdate:function(){l&&(e===o.camera.ARC_CAMERA||a.setTarget(l))}});n.activeCamera=a,this.execute(o.commands.SET_CAMERA_CONTROL,{enabled:!0})}}},{key:"setRenderType",value:function(e){this.scene.materials;switch(e){case o.render.ORDINARY:this.scene.forceWireframe=!1;break;case o.render.WIREFRAME:this.scene.forceWireframe=!0}}},{key:"createSkyBox",value:function(){}},{key:"updateSetting",value:function(e){var t=/^camera:(.*)/,n=/^anno:(.*)/,i=/^render:(.*)/,a=/^speed:(.*)/,o=void 0;if(o=t.exec(e))this.updateCamera(o[1]);else if(o=n.exec(e))"hide"===o[1]?this.setAnnotationVisible(!1):this.setAnnotationVisible(!0);else if(o=i.exec(e))this.setRenderType(o[1]);else if(o=a.exec(e)){var s=parseFloat(o[1].replace("x"));this.scene.animationTimeScale=s}}},{key:"focusingOn",value:function(e,t){var n=new p(this,t);return Object.assign(n.position,e),n}},{key:"dispose",value:function(){this.player&&this.player.dispose();var e=this.data.emitter;window.removeEventListener("resize",this._resize),e&&e.removeListener&&e.removeListener("update",this.renderFunc),this.scene.dispose(),delete this.scene.babylonScene,delete this.scene,window.b===this&&delete window.b,this.commandManager&&this.commandManager.clearAllCommand(),delete this.data.canvas,delete this.data.emitter,delete this.data}},{key:"updateInteractiveCanvas",value:function(e){this.scene.detachControl(),this.scene.interactiveCanvas=e,this.scene.actionManager&&this.scene.actionManager.register(),this.scene.attachControl()}},{key:"execute",value:function(e,t){return this.commandManager.execute(e,t)}}]),e}();e.exports=O},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(452),o=n(447),s=function e(t){function n(e){if(0===e.sourceEvent.button&&o.isDebug&&e.sourceEvent.shiftKey){var n=(e.source,new a(t));n.showTip();var i=s.pick(e.pointerX,e.pointerY),r=i.pickedPoint;i.getNormal(!0);n.position.copyFrom(r),e.sourceEvent.ctrlKey?n.takeSceneSnapshot({id:i.pickedMesh.id,name:i.pickedMesh.name}):n.takeSceneSnapshot()}}i(this,e);var s=t.scene,r=(s.actionManager,new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnLongPressTrigger,n));s.meshes.forEach(function(e){e.actionManager&&e.actionManager.registerAction(r)})};e.exports=s},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=(n(447),{fill:"#FFFFFF",font:'normal 30px "Microsoft Yahei"'}),c=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.text=new PIXI.Text("",r),n.graphics=new PIXI.Graphics,n.addChild(n.graphics),n.addChild(n.text),n.updateText(""),n.babylonScene=e,window.NBGesture?(NBGesture.addGesture(n.graphics,"gesture.tap",n.tipTap.bind(n)),NBGesture.addGesture(n.text,"gesture.tap",n.tipTap.bind(n))):(n.interactive=!0,n.on("pointerdown",n.tipTap.bind(n))),n.buttonMode=!0,n}return o(t,e),s(t,[{key:"tipTap",value:function(){this.babylonScene.lookAtSpriteByName(this.text.text)}},{key:"updateText",value:function(e){this.text.text!==e&&(this.text.text=e||"",this.w=Math.max(this.text.width,100)+40,this.h=60)}},{key:"render",value:function(e){for(var t=void 0,n=0;n<e.length;n++)t=e[n],t=this.toLocal(t),0===n&&(this.graphics.clear(),this.graphics.lineStyle(2,4473924),this.graphics.beginFill(0));var i=this.w,a=this.h;this.graphics.drawRect(t.x-i/2,t.y-a/2,i,a),this.text.x=t.x-i/2+(i-this.text.width)/2,this.text.y=t.y-a/2+(a-this.text.height)/2}},{key:"dispose",value:function(){this.babylonScene&&(this.parent.removeChild(this),this.graphics.clear(),this.removeChild(this.graphics),this.removeChild(this.text),this.babylonScene=null)}}]),t}(PIXI.Container);e.exports=c},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(447),c=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.scene));return n.babylonScene=e,n.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnLeftPickTrigger,n.onPickTrigger.bind(n))),r.isDebug&&n.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnRightPickTrigger,n.onRightPickTrigger.bind(n))),n}return o(t,e),s(t,[{key:"onRightPickTrigger",value:function(e){var t=e.source;e.sourceEvent.ctrlKey?window.confirm("是否需要更新当快照数据?")&&t.takeSceneSnapshot():window.confirm("确定删除当前tip?")&&(t.dispose(),this.babylonScene.execute(r.commands.UPDATE_ANNOTATION_DATA))}},{key:"onPickTrigger",value:function(e){e.source.zoomIn()}}]),t}(BABYLON.ActionManager);e.exports=c},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(447),c=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.scene));return n.babylonScene=e,n.register(),n}return o(t,e),s(t,[{key:"register",value:function(){this.babylonScene.scene.onPointerObservable.add(this.sceneDBClick.bind(this),BABYLON.PointerEventTypes.POINTERDOUBLETAP),this.babylonScene.scene.onPointerObservable.add(this.sceneClick.bind(this),BABYLON.PointerEventTypes.POINTERTAP)}},{key:"sceneClick",value:function(e,t){if(!this.getScene().pickSprite(e.event.clientX,e.event.clientY).pickedSprite){var i=n(452);i.lastTip&&(i.lastTip.hideTip(),i.lastTip=null,this.babylonScene.execute(r.commands.UPDATE_ANNOTATION_DATA))}}},{key:"sceneDBClick",value:function(e,t){e.pickInfo.pickedMesh||this.babylonScene.zoomOut()}}]),t}(BABYLON.ActionManager);e.exports=c},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in a)return a.value;var s=a.get;if(void 0!==s)return s.call(i)},l=n(447),u=(n(450),function(e){function t(e,n){i(this,t);var o=e.scene;s||(s=new BABYLON.SpriteManager("focusing",n||l.config.URI_PREFIX+"assets/textures/focusing.png",10,64,o),s.isPickable=!0,s.tempSprites=[],s.renderingGroupId=1,e.focusingManager=s);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"focusing",s));return r.babylonScene=e,r.isPickable=!0,r.actionManager=new BABYLON.ActionManager(o),r.dSprite=new BABYLON.Sprite("double",s),r.dSprite.position=r.position,r.tsize=.2,TweenMax.to(r,.7,{tsize:.4,repeat:-1}),r.dSprite.tsize=.3,TweenMax.to(r.dSprite,.7,{tsize:.5,repeat:-1,delay:.1}),s.tempSprites.push(r,r.dSprite),r}return o(t,e),r(t,[{key:"dispose",value:function(){var e=this;TweenMax.killTweensOf(this),TweenMax.killTweensOf(this.dSprite),TweenMax.to([this,this.dSprite],.5,{size:0,onComplete:function(){e.dSprite.dispose(),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",e).call(e),s=null}})}}]),t}(BABYLON.Sprite));e.exports=u},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(447),s=function(){function e(t){i(this,e),this.babylonScene=t,this.scene=t.scene}return a(e,[{key:"updateAnimatables",value:function(){this.scene.Animatables&&this.scene.Animatables.forEach(function(e){e.getAnimations().forEach(function(t){var n=t.getHighestFrame?t.getHighestFrame():t.animation.getHighestFrame();e.toFrame=n})})}},{key:"pause",value:function(){this.scene.Animatables&&this.scene.Animatables.forEach(function(e){e.pause()})}},{key:"restart",value:function(){this.scene.Animatables&&this.scene.Animatables.forEach(function(e){e.restart()})}},{key:"reset",value:function(){this.scene.Animatables&&this.scene.Animatables.forEach(function(e){e.reset()})}},{key:"tweenToProgress",value:function(e,t){if(this.scene.Animatables){t=t||{},this.babylonScene.execute(o.commands.PLAY_ANIMATION_COMMAND,!1);var n=this.getProgress(),i=this,a=TweenMax.to(this,t.duration||1,{ease:t.ease||null,onUpdate:function(){var t=n+(e-n)*a.ratio;i.setProgress(t)},onComplete:t.complete||null})}}},{key:"tweenToProgressOfActive",value:function(e,t){if(this.scene.Animatables){t=t||{},this.babylonScene.execute(o.commands.PLAY_ANIMATION_COMMAND,!1);var n=this.getProgressOfActive(),i=this,a=TweenMax.to(this,t.duration||1,{ease:t.ease||null,onUpdate:function(){var t=n+(e-n)*a.ratio;i.setProgressOfActive(t)},onComplete:t.complete||null})}}},{key:"tweenToFrame",value:function(e,t){if(this.scene.Animatables){t=t||{},this.babylonScene.execute(o.commands.PLAY_ANIMATION_COMMAND,!1);var n=this.getProgress()*this._totalFrames,i=this,a=TweenMax.to(this,t.duration||1,{ease:t.ease||null,onUpdate:function(){var t=n+(e-n)*a.ratio;i.setFrame(t)},onComplete:t.complete||null})}}},{key:"getTotalFrames",value:function(){if(!this.scene.Animatables)return 0;if(!this._totalFrames){this._totalFrames=0;for(var e=this.scene.Animatables,t=0;t<e.length;t++)for(var n=e[t],i=n.getAnimations(),a=0;a<i.length;a++){var o=i[a].animation||i[a];this._totalFrames=Math.max(this._totalFrames,o.getHighestFrame())}}return this._totalFrames}},{key:"getActiveFrames",value:function(){if(!this.scene.Animatables)return 0;if(!this._activeFrames){this._activeFrames={fromFrame:0,toFrame:this._totalFrames||this.getTotalFrames()};for(var e=this.scene.Animatables,t=0;t<e.length;t++){var n=e[t];this._activeFrames.fromFrame=Math.min(this._activeFrames.fromFrame,n.fromFrame),this._activeFrames.toFrame=Math.max(this._activeFrames.toFrame,n.toFrame)}this._activeFrames.frameNumbers=this._activeFrames.toFrame-this._activeFrames.fromFrame}return this._activeFrames}},{key:"getProgress",value:function(){if(this.scene.Animatables){var e=this.scene.Animatables,t=0,n=this.getTotalFrames(),i=NaN;e.forEach(function(e){if(t=Math.min(t,e.fromFrame),n=Math.min(n,e.toFrame),isNaN(i))for(var a=e.getAnimations(),o=0;o<a.length;o++){var s=a[o];i=s.currentFrame}});return(i-t)/(n-t)}}},{key:"getProgressOfActive",value:function(){if(this.scene.Animatables){var e=this.scene.Animatables,t=NaN;e.forEach(function(e){if(isNaN(t))for(var n=e.getAnimations(),i=0;i<n.length;i++){var a=n[i];t=a.currentFrame}});var n=this.getActiveFrames(),i=n.frameNumbers;return(t-n.fromFrame)/i}}},{key:"setProgress",value:function(e){if(this.scene.Animatables)for(var t=this.scene.Animatables,n=0;n<t.length;n++){var i=t[n],a=i.fromFrame,o=i.toFrame,s=(o-a)*e;i.goToFrame(s)}}},{key:"setProgressOfActive",value:function(e){if(this.scene.Animatables)for(var t=this.scene.Animatables,n=this.getActiveFrames(),i=n.fromFrame,a=n.toFrame,o=i+(a-i)*e,s=0;s<t.length;s++){var r=t[s];r.goToFrame(o)}}},{key:"setFrame",value:function(e){if(this.scene.Animatables)for(var t=this.scene.Animatables,n=0;n<t.length;n++)t[n].goToFrame(e)}},{key:"setPlaySegment",value:function(e,t){this.scene.Animatables&&this.scene.Animatables.forEach(function(n){n.getAnimations().forEach(function(i){n.toFrame=t,n.fromFrame=e})})}}]),e}();e.exports=s},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(454),s=function(){function e(t){i(this,e),this.map={},t.on&&t.on("execute",function(e){var t=e.type,n=e.data;this.execute(t,n)}),this.root=t}return a(e,[{key:"clearAllCommand",value:function(){for(var e in this.map)delete this.map[e]}},{key:"registerCommand",value:function(e,t){if(this.map[e])throw e+"命令重复";this.map[e]=t}},{key:"executeCommand",value:function(e,t){if(!e||""===e)throw new Error("没有传入command");var n=this.map[e];if(n){var i=new n;if(!(i instanceof o))throw"commandClass必须继承ICommand";return i.root=this.root,i.manager=this,i.execute(t)}}},{key:"execute",value:function(){return this.executeCommand.apply(this,arguments)}}]),e}();e.exports=s},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(447),o=n(482),s=n(483),r=n(484),c=n(485),l=n(486),u=n(487),h=n(488),p=n(489),d=n(490),f=n(491),v=n(492),b=n(494),m=n(495),y=function e(t){i(this,e),t.registerCommand(a.commands.UPDATE_ANNOTATION_DATA,o),t.registerCommand(a.commands.PLAY_ANIMATION_COMMAND,s),t.registerCommand(a.commands.SET_ANNOTATION_VISIBLE,r),t.registerCommand(a.commands.UPDATE_SETTING_PANEL,c),t.registerCommand(a.commands.CHECK_ENV,l),t.registerCommand(a.commands.CONFIGURE_MATERIAL,u),t.registerCommand(a.commands.CONFIGURE_PIPELINE,h),t.registerCommand(a.commands.SET_CAMERA_CONTROL,p),t.registerCommand(a.commands.DISPOSE,d),t.registerCommand(a.commands.SCENE_CAPTURE,f),t.registerCommand(a.commands.OBSERVE_MESH_BY_FRAME,v),t.registerCommand(a.commands.PIXI_PLUGIN,b),t.registerCommand(a.commands.OBSERVE_MESH_BY_RORATE,m)};e.exports=y},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(448).ICommand,c=n(447),l=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){if(c.isDebug){var t=this.root.retrieveSprites(c.sprite.ANNOTATION),n=[];t.forEach(function(e){var t=e.getSceneData();t&&n.push(t)});var i=/\/course\/(\d+)/.exec(location.href),a=void 0;a=i?i[1]:window.courseID||"";var o=this.root.data.tipURL;if(!o)return void alert("没有指定tipURL");var s=JSON.stringify({data:n,path:o});console.log(o),$.ajax({url:"/nb-web-3d/writeFile/"+a,type:"POST",contentType:"application/json",data:s})}}}]),t}(r);e.exports=l},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(448).ICommand,c=(n(447),function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){var t=this.root.animationManager,n=$(".ani-play-button");this.root.player.enabledAni=e;var i=void 0,a=void 0;"boolean"==typeof e?i=e:(i=e.play,a=e.reset,isNaN(e.timeScale)||(this.root.scene.animationTimeScale=e.timeScale)),a&&t.reset(),i?(t.restart(),n.removeClass("glyphicon-play"),n.addClass("glyphicon-pause")):(t.pause(),n.removeClass("glyphicon-pause"),n.addClass("glyphicon-play"))}}]),t}(r));e.exports=c},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(448).ICommand,c=n(447),l=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){this.root.setAnnotationVisible(e);var t=$("#setting-annotation"),n=t[0].lastSelector;$(n).removeClass("select");var i=void 0;e?(i=t.children()[0],$(i).addClass("select")):(i=t.children()[1],$(i).addClass("select")),t[0].lastSelector=i,this.root.execute(c.commands.UPDATE_SETTING_PANEL)}}]),t}(r);e.exports=l},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(448).ICommand,c=(n(447),function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){$(".setting.menu-item").toArray().forEach(function(e){var t=$(e),n=t.attr("id").replace("setting","val"),i=t.find(".select")[0],a=i.parentElement;a.lastSelector?i=a.lastSelector:a.lastSelector=i;var o=$(i),s=o.text();$("#"+n).text(s)})}}]),t}(r));e.exports=c},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(448).ICommand,c=n(447),l=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){return new Promise(function(e,t){$.ajax({url:"/nb-web-3d/check-env",type:"GET",contentType:"application/json"}).done(function(t){"success"===t&&(c.isDebug=!0,window.addEventListener("keydown",function(e){16===e.keyCode&&(c.shiftDown=!0)}),window.addEventListener("keyup",function(e){16===e.keyCode&&(c.shiftDown=!1)}),e())}).error(function(e){t()})})}}]),t}(r);e.exports=l},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(448).ICommand,c=(n(447),function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){if(e.globalMaterial){var t=this.root,n=e.globalMaterial,i=!1,a=0;if(n.environmentReflection){var o=n.environmentReflection;i=o.enabled,a=o.level}var s=this.root.scene,r=s.materials;s.environmentTexture&&(s.environmentTexture.level=a);t.data.skybox&&t.data.skybox.pbr?s.getMaterialByName("skyBox").reflectionTexture:s.environmentTexture,r.forEach(function(e){e instanceof BABYLON.StandardMaterial&&(i?(e.reflectionTexture=s.environmentTexture,e.roughness=n.roughness||0):(e.reflectionTexture=null,e.roughness=0))})}}}]),t}(r));e.exports=c},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(448).ICommand,c=(n(447),function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){var t=e.pipeline;if(t){var n=this.root.scene.activeCamera,i=this.root.scene,a=new BABYLON.StandardRenderingPipeline("standard",i,1,null,[n]);a.BloomEnabled=!1;var o=t.bloom;o&&(a.BloomEnabled=o.enabled);var s=t.motionBlur;s.enabled&&(a.MotionBlurEnabled=s.enabled,a.motionStrength=s.motionStrength||.05,a.motionBlurSamples=s.motionBlurSamples||32);var r=t.depthOfField;r&&(a.DepthOfFieldEnabled=r.enabled,a.depthOfFieldDistance=r.distance||100,a.depthOfFieldBlurWidth=r.blurWidth||100);if(t.fxaaEnabled||!1){new BABYLON.FxaaPostProcess("fxaa",1,n);a.fxaaEnabled=!0}}}}]),t}(r));e.exports=c},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(448).ICommand,c=(n(447),function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){var t=this.root.scene,n=t.activeCamera;if(n&&e){e.enabled?(n.attachControl(window,!0),n instanceof BABYLON.ArcRotateCamera&&(n._useCtrlForPanning=!1)):n.detachControl(window)}}}]),t}(r));e.exports=c},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(448).ICommand,c=(n(447),function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){this.root.dispose()}}]),t}(r));e.exports=c},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(448).ICommand,c=(n(447),15),l=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){function t(){0!==r&&BABYLON.Tools.CreateScreenshotUsingRenderTarget(o,a,s,function(e){$.post({url:"/nb-web-3d/writeCaptureImage/test",data:{data:e,index:r},dataType:"json",success:function(){console.log("抓取图片第 "+(c-r)+" 张"),r--,t()}})})}var n=this.root,i=n.scene,a=i.activeCamera,o=i.getEngine(),s={width:800,height:600},r=c;t()}}]),t}(r);e.exports=l},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in a)return a.value;var s=a.get;if(void 0!==s)return s.call(i)},c=n(493),l=n(447),u=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){this.wireframeColor=void 0===e.color?BABYLON.Color3.White():BABYLON.Color3.FromHexString("#"+e.color.toString(16)),this.wireframeAlpha=e.wireframeAlpha||1,r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"execute",this).call(this,e)}},{key:"handleMesh",value:function(e){var t=e.material.clone();t.alphaOrigin=e.material.alpha,e.material=new BABYLON.MultiMaterial(l.UID(),this.scene);var n=new BABYLON.StandardMaterial(l.UID(),this.scene);n.diffuseColor=this.wireframeColor,n.specularPower=0,n.wireframe=!0,e.material.subMaterials.push(t,n)}},{key:"setMeshObserve",value:function(e,t){var n=e.material.subMaterials[0],i=e.material.subMaterials[1];if(TweenMax.killTweensOf(i),TweenMax.killTweensOf(n),t){if(!e.tempSubMesh){var a=e.getTotalVertices(),o=e.getTotalIndices();e.tempSubMesh=new BABYLON.SubMesh(1,0,a,0,o,e),i.alpha=0}TweenMax.to(i,.75,{alpha:this.wireframeAlpha}),TweenMax.to(n,.75,{delay:.75,alpha:0})}else e.tempSubMesh&&(TweenMax.to(i,.75,{delay:.75,alpha:0,onComplete:function(){e.tempSubMesh.dispose(),delete e.tempSubMesh}}),TweenMax.to(n,.75,{alpha:n.alphaOrigin}))}}]),t}(c);e.exports=u},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return!e.isImported||!e.material}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=n(448).ICommand,l=n(447),u=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),r(t,[{key:"execute",value:function(e){var t=this;if(!e)throw"必须要传入对象";var n=this.root.scene,i=this;this.scene=n;var a=n.meshes,o=this;this.nameFilter=e.nameFilter||/observe_/,this.otherthanFilter=e.otherthan||/!./,a.forEach(function(n){s(n)||(t.nameFilter.test(n.name)&&(n.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnDoublePickTrigger,o.meshDoubleClick.bind(t))),e.bindAnnotationToMesh&&n.actionManager.registerAction(new BABYLON.ExecuteCodeAction(l.action.ANNOTATION_CLICK_TRIGGER,o.meshDoubleClick.bind(t)))),o.handleMesh(n))}),i.root.resetSceneMesh=i.zoomOut.bind(this),n.onPointerObservable.add(this.sceneDBClick.bind(this),BABYLON.PointerEventTypes.POINTERDOUBLETAP)}},{key:"meshDoubleClick",value:function(e){var t=this,n=this;this.observeMesh&&this.observeMesh===e.source||(this.observeMesh=e.source,this.scene.meshes.forEach(function(e){s(e)||t.otherthanFilter.test(e.name)||(e===t.observeMesh||e.bindMesh&&e.bindMesh===t.observeMesh?n.setMeshObserve(e,!1):n.setMeshObserve(e,!0))}))}},{key:"handleMesh",value:function(e){throw"子类需要重写"}},{key:"setMeshObserve",value:function(e,t){throw"子类需要重写"}},{key:"sceneDBClick",value:function(e){var t=this;if(!e.pickInfo.pickedMesh){if(!this.observeMesh)return;this.scene.meshes.forEach(function(e){s(e)||t.setMeshObserve(e,!1)}),this.observeMesh=null}}},{key:"zoomOut",value:function(){var e=this;this.scene.meshes.forEach(function(t){s(t)||e.setMeshObserve(t,!1)}),this.observeMesh=null}}]),t}(c);e.exports=u},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(448).ICommand,c=n(447),l=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){function t(e){var t={};o.mapPositionToPoint(t,e.clientX,e.clientY),o.processInteractive(t,instance.viewStack,function(){},!0)&&(a.addEventListener("pointerup",n),i.execute(c.commands.SET_CAMERA_CONTROL,{enabled:!1}))}function n(e){a.removeEventListener("pointerup",n),i.execute(c.commands.SET_CAMERA_CONTROL,{enabled:!0})}var i=this.manager;if(!window.PIXI||!window.instance)return void console.log("没有指定instance 无法做3D与PIXI的兼容");var a=$("#bioCanvas")[0];if(!a)return void console.log("没有指定canvas, 无法做3D与2D交互的兼容");var o=instance.renderer.plugins.interaction;a.addEventListener("pointerdown",t,!0)}}]),t}(r);e.exports=l},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(448).ICommand,c=(n(447),function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"execute",value:function(e){function t(){if(s){var e=i.pointerX,t=e-r;r=e,s.rotation[s.useAxis]-=t/200}}function n(){s=null}var i=this.root.scene;this.scene=i;var a=this.root;i.activeCamera.upperAlphaLimit=i.activeCamera.lowerAlphaLimit=a.data.camera.alpha,i.activeCamera.upperBetaLimit=i.activeCamera.lowerBetaLimit=a.data.camera.beta;var o=e.meshes,s=null,r=null;i.registerBeforeRender(t);var c=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickUpTrigger,n),l=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickOutTrigger,n),u=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnLeftPickTrigger,function(e){s=e.source,r=e.pointerX});o.forEach(function(e){try{var t=i.getMeshByName(e.name+"_area");t.visibility=0;var n=i.getMeshByName(e.name+"_model");n.rotation=t.rotation;var a=i.getMeshByName(e.name+"_base"),o=t.getBoundingInfo(),s=o.diagonalLength,r=o.boundingSphere.center,h=o.boundingBox.maximumWorld,p=o.boundingBox.minimumWorld;console.log(o,s,r,h,p);var d=a.getBoundingInfo().boundingSphere.center,f=r.clone();console.log(t.name,f),f.z=0,t.setPivotPoint(d),n.setPivotPoint(d),e.reposition&&(t.position=f.clone(),n.position=f.clone()),t.useAxis=e.axis||"z",t.actionManager||(t.actionManager=new BABYLON.ActionManager(i)),t.actionManager.registerAction(u),t.actionManager.registerAction(c),t.actionManager.registerAction(l)}catch(e){console.error(e)}})}}]),t}(r));e.exports=c},function(e,t,n){"use strict";!function(){var t=n(497),i=n(455).utf8,a=n(498),o=n(455).bin,s=function e(n,s){n.constructor==String?n=s&&"binary"===s.encoding?o.stringToBytes(n):i.stringToBytes(n):a(n)?n=Array.prototype.slice.call(n,0):Array.isArray(n)||(n=n.toString());for(var r=t.bytesToWords(n),c=8*n.length,l=1732584193,u=-271733879,h=-1732584194,p=271733878,d=0;d<r.length;d++)r[d]=16711935&(r[d]<<8|r[d]>>>24)|4278255360&(r[d]<<24|r[d]>>>8);r[c>>>5]|=128<<c%32,r[14+(c+64>>>9<<4)]=c;for(var f=e._ff,v=e._gg,b=e._hh,m=e._ii,d=0;d<r.length;d+=16){var y=l,g=u,A=h,O=p;l=f(l,u,h,p,r[d+0],7,-680876936),p=f(p,l,u,h,r[d+1],12,-389564586),h=f(h,p,l,u,r[d+2],17,606105819),u=f(u,h,p,l,r[d+3],22,-1044525330),l=f(l,u,h,p,r[d+4],7,-176418897),p=f(p,l,u,h,r[d+5],12,1200080426),h=f(h,p,l,u,r[d+6],17,-1473231341),u=f(u,h,p,l,r[d+7],22,-45705983),l=f(l,u,h,p,r[d+8],7,1770035416),p=f(p,l,u,h,r[d+9],12,-1958414417),h=f(h,p,l,u,r[d+10],17,-42063),u=f(u,h,p,l,r[d+11],22,-1990404162),l=f(l,u,h,p,r[d+12],7,1804603682),p=f(p,l,u,h,r[d+13],12,-40341101),h=f(h,p,l,u,r[d+14],17,-1502002290),u=f(u,h,p,l,r[d+15],22,1236535329),l=v(l,u,h,p,r[d+1],5,-165796510),p=v(p,l,u,h,r[d+6],9,-1069501632),h=v(h,p,l,u,r[d+11],14,643717713),u=v(u,h,p,l,r[d+0],20,-373897302),l=v(l,u,h,p,r[d+5],5,-701558691),p=v(p,l,u,h,r[d+10],9,38016083),h=v(h,p,l,u,r[d+15],14,-660478335),u=v(u,h,p,l,r[d+4],20,-405537848),l=v(l,u,h,p,r[d+9],5,568446438),p=v(p,l,u,h,r[d+14],9,-1019803690),h=v(h,p,l,u,r[d+3],14,-187363961),u=v(u,h,p,l,r[d+8],20,1163531501),l=v(l,u,h,p,r[d+13],5,-1444681467),p=v(p,l,u,h,r[d+2],9,-51403784),h=v(h,p,l,u,r[d+7],14,1735328473),u=v(u,h,p,l,r[d+12],20,-1926607734),l=b(l,u,h,p,r[d+5],4,-378558),p=b(p,l,u,h,r[d+8],11,-2022574463),h=b(h,p,l,u,r[d+11],16,1839030562),u=b(u,h,p,l,r[d+14],23,-35309556),l=b(l,u,h,p,r[d+1],4,-1530992060),p=b(p,l,u,h,r[d+4],11,1272893353),h=b(h,p,l,u,r[d+7],16,-155497632),u=b(u,h,p,l,r[d+10],23,-1094730640),l=b(l,u,h,p,r[d+13],4,681279174),p=b(p,l,u,h,r[d+0],11,-358537222),h=b(h,p,l,u,r[d+3],16,-722521979),u=b(u,h,p,l,r[d+6],23,76029189),l=b(l,u,h,p,r[d+9],4,-640364487),p=b(p,l,u,h,r[d+12],11,-421815835),h=b(h,p,l,u,r[d+15],16,530742520),u=b(u,h,p,l,r[d+2],23,-995338651),l=m(l,u,h,p,r[d+0],6,-198630844),p=m(p,l,u,h,r[d+7],10,1126891415),h=m(h,p,l,u,r[d+14],15,-1416354905),u=m(u,h,p,l,r[d+5],21,-57434055),l=m(l,u,h,p,r[d+12],6,1700485571),p=m(p,l,u,h,r[d+3],10,-1894986606),h=m(h,p,l,u,r[d+10],15,-1051523),u=m(u,h,p,l,r[d+1],21,-2054922799),l=m(l,u,h,p,r[d+8],6,1873313359),p=m(p,l,u,h,r[d+15],10,-30611744),h=m(h,p,l,u,r[d+6],15,-1560198380),u=m(u,h,p,l,r[d+13],21,1309151649),l=m(l,u,h,p,r[d+4],6,-145523070),p=m(p,l,u,h,r[d+11],10,-1120210379),h=m(h,p,l,u,r[d+2],15,718787259),u=m(u,h,p,l,r[d+9],21,-343485551),l=l+y>>>0,u=u+g>>>0,h=h+A>>>0,p=p+O>>>0}return t.endian([l,u,h,p])};s._ff=function(e,t,n,i,a,o,s){var r=e+(t&n|~t&i)+(a>>>0)+s;return(r<<o|r>>>32-o)+t},s._gg=function(e,t,n,i,a,o,s){var r=e+(t&i|n&~i)+(a>>>0)+s;return(r<<o|r>>>32-o)+t},s._hh=function(e,t,n,i,a,o,s){var r=e+(t^n^i)+(a>>>0)+s;return(r<<o|r>>>32-o)+t},s._ii=function(e,t,n,i,a,o,s){var r=e+(n^(t|~i))+(a>>>0)+s;return(r<<o|r>>>32-o)+t},s._blocksize=16,s._digestsize=16,e.exports=function(e,n){if(void 0===e||null===e)throw new Error("Illegal argument "+e);var i=t.wordsToBytes(s(e,n));return n&&n.asBytes?i:n&&n.asString?o.bytesToString(i):t.bytesToHex(i)}}()},function(e,t,n){"use strict";!function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,i=0;n<e.length;n++,i+=8)t[i>>>5]|=e[n]<<24-i%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var n=[],i=0;i<e.length;i+=3)for(var a=e[i]<<16|e[i+1]<<8|e[i+2],o=0;o<4;o++)8*i+6*o<=8*e.length?n.push(t.charAt(a>>>6*(3-o)&63)):n.push("=");return n.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],i=0,a=0;i<e.length;a=++i%4)0!=a&&n.push((t.indexOf(e.charAt(i-1))&Math.pow(2,-2*a+8)-1)<<2*a|t.indexOf(e.charAt(i))>>>6-2*a);return n}};e.exports=n}()},function(e,t,n){"use strict";function i(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function a(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&i(e.slice(0,0))}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&(i(e)||a(e)||!!e._isBuffer)}},function(e,t,n){"use strict";function i(e,t,n){function i(t){var n=y,i=g;return y=g=void 0,E=t,O=e.apply(i,n)}function u(e){return E=e,x=setTimeout(d,t),w?i(e):O}function h(e){var n=e-M,i=e-E,a=t-n;return B?l(a,A-i):a}function p(e){var n=e-M,i=e-E;return void 0===M||n>=t||n<0||B&&i>=A}function d(){var e=o();if(p(e))return f(e);x=setTimeout(d,h(e))}function f(e){return x=void 0,T&&y?i(e):(y=g=void 0,O)}function v(){void 0!==x&&clearTimeout(x),E=0,y=M=g=x=void 0}function b(){return void 0===x?O:f(o())}function m(){var e=o(),n=p(e);if(y=arguments,g=this,M=e,n){if(void 0===x)return u(M);if(B)return x=setTimeout(d,t),i(M)}return void 0===x&&(x=setTimeout(d,t)),O}var y,g,A,O,x,M,E=0,w=!1,B=!1,T=!0;if("function"!=typeof e)throw new TypeError(r);return t=s(t)||0,a(n)&&(w=!!n.leading,B="maxWait"in n,A=B?c(s(n.maxWait)||0,t):A,T="trailing"in n?!!n.trailing:T),m.cancel=v,m.flush=b,m}var a=n(456),o=n(500),s=n(502),r="Expected a function",c=Math.max,l=Math.min;e.exports=i},function(e,t,n){"use strict";var i=n(457),a=function(){return i.Date.now()};e.exports=a},function(e,t,n){"use strict";(function(t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i="object"==(void 0===t?"undefined":n(t))&&t&&t.Object===Object&&t;e.exports=i}).call(t,n(1))},function(e,t,n){"use strict";function i(e){if("number"==typeof e)return e;if(o(e))return s;if(a(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=a(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var n=l.test(e);return n||u.test(e)?h(e.slice(2),n?2:8):c.test(e)?s:+e}var a=n(456),o=n(503),s=NaN,r=/^\s+|\s+$/g,c=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,u=/^0o[0-7]+$/i,h=parseInt;e.exports=i},function(e,t,n){"use strict";function i(e){return"symbol"==(void 0===e?"undefined":a(e))||s(e)&&o(e)==r}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(504),s=n(507),r="[object Symbol]";e.exports=i},function(e,t,n){"use strict";function i(e){return null==e?void 0===e?c:r:l&&l in Object(e)?o(e):s(e)}var a=n(458),o=n(505),s=n(506),r="[object Null]",c="[object Undefined]",l=a?a.toStringTag:void 0;e.exports=i},function(e,t,n){"use strict";function i(e){var t=s.call(e,c),n=e[c];try{e[c]=void 0;var i=!0}catch(e){}var a=r.call(e);return i&&(t?e[c]=n:delete e[c]),a}var a=n(458),o=Object.prototype,s=o.hasOwnProperty,r=o.toString,c=a?a.toStringTag:void 0;e.exports=i},function(e,t,n){"use strict";function i(e){return o.call(e)}var a=Object.prototype,o=a.toString;e.exports=i},function(e,t,n){"use strict";function i(e){return null!=e&&"object"==(void 0===e?"undefined":a(e))}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=i},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(447),c=r.TWEEN_TIMER,l=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.scene));return n.babylonScene=e,n.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnDoublePickTrigger,n.doublePicker.bind(e))),n.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger,n.pointerOver.bind(e))),n.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger,n.pointerOut.bind(e))),n}return o(t,e),s(t,[{key:"doublePicker",value:function(e){var t=this.scene,n=t._currentPickResult,i=e.pickedPoint||n.pickedPoint,a=t.activeCamera,o=this.getEaseFunc();this.lookAtVector(i);var s=BABYLON.Mesh.MinMax([e.source]),r=1.25*BABYLON.Vector3.Distance(s.min,s.max);e.ignoreCameraDistance?TweenMax.to(a,c,{radius:r,ease:o}):r<a.radius&&TweenMax.to(a,c,{radius:r,ease:o})}},{key:"pointerOver",value:function(e){e.source.meshData}},{key:"pointerOut",value:function(e){e.source}}]),t}(BABYLON.ActionManager);e.exports=l},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=12,s=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bioCanvas";i(this,e),window.addEventListener("resize",this.resize),this.originScene=t;var a=$("#"+n)[0];if(!a)throw"请指定监听事件的canvas对象";$(t.data.canvas).css("display","none"),this.addListener(a),this.imageIndex=0}return a(e,[{key:"addListener",value:function(e){function t(e){var t=instance.renderer.plugins.interaction,o={};t.mapPositionToPoint(o,e.clientX,e.clientY),t.processInteractive(o,instance.viewStack,function(){},!0)||(a=e.clientX,window.addEventListener("pointermove",n),window.addEventListener("pointerup",i))}function n(e){e.clientX-a>o?(a=e.clientX,s.nextImage()):e.clientX-a<-o&&(a=e.clientX,s.prevImage())}function i(){window.removeEventListener("pointermove",n),window.removeEventListener("pointerup",i)}var a=0,s=this;e.addEventListener("pointerdown",t)}},{key:"nextImage",value:function(){this.imageIndex--,this.updateImage()}},{key:"prevImage",value:function(){this.imageIndex++,this.updateImage()}},{key:"updateImage",value:function(){this.imageIndex%=15,this.imageIndex<0?this.imageIndex+=15:this.imageIndex>15&&(this.imageIndex-=15);var e=1e3*this.imageIndex;console.log(e),$("#nb2dImg").css("transform","translate(-"+e+"px, 0px)")}},{key:"loadMesh",value:function(e){if(e){var t=this,n=e.replace(".babylon","-2d.jpg"),i=$("#nb2dImg");if(0===i.length){$(document.body).append('\n\t\t\t\t<div class="babylon-2d-wrapper">\n\t\t\t\t\t<div class="babylon-2d">\n\t\t\t\t\t\t<img id="nb2dImg"></img>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t'),$("#nb2dImg")[0].addEventListener("load",function(){t.originScene.setLoading(!1,1)})}i=$("#nb2dImg"),i.attr("src",n),this.resize()}}},{key:"resize",value:function(){var e=$(".babylon-2d");if(e[0]){var t=e.width();e.height();e.css("left",-(t-window.innerWidth>>1)+"px")}}},{key:"disposeSceneObjects",value:function(){}}]),e}();e.exports=s},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(447),s=n(450),r=function(){function e(t,a){function s(e){0===m&&(m=$(".player-controls .timeline").position().left),p.pause(),window.addEventListener("pointermove",r),window.addEventListener("pointerup",c),r(e)}function r(e){console.log("move");var t=e.x-m;t<0?t=0:t>l.trackWidth&&(t=l.trackWidth);var n=t/l.trackWidth;isNaN(n)||(p.setProgress(n),b=n)}function c(){l.enabledAni&&p.restart(),window.removeEventListener("pointermove",r),window.removeEventListener("pointerup",c)}i(this,e),this.babylonScene=t,this.enabledAni=!0;var l=this;this.settingItemMap={};var u=(t.scene,n(511)),h=$(u);this.element=h;var p=this.babylonScene.animationManager;$("body").append(h),a&&!a.isShowPlaybar&&$(".player-controls").css("display","none"),a&&this.setData(a),t.execute(o.commands.UPDATE_SETTING_PANEL);var d=$(".threed-player"),f=d.find(".menu-item.first-level");f.click(this.menuItemClick.bind(this)),f.toArray().forEach(function(e){var t=$(e).find(".setting-value").attr("id");l.settingItemMap[t]=$(e)}),$(".setting-option .back").click(this.backBtnClick.bind(this)),this.playerSetting=$(".player-setting"),this.playerSetting.click(function(e){e.stopPropagation()}),$("#setting-btn").click(this.clearStyle.bind(this)),$("#level2-setting .setting p").click(function(e){console.log(l);var n=e.currentTarget.parentElement;if(n.lastSelector||(n.lastSelector=n.children[0]),n.lastSelector!==e.currentTarget){$(n.lastSelector).removeClass("select");var i=$(e.currentTarget);i.addClass("select");var a=i.attr("type");console.log(e),n.lastSelector=e.currentTarget;var o=i.text(),s=i.parent().attr("id").split("-")[1],r="val-"+s;$("#"+r).text(o),t.updateSetting(a)}});var v=$(".ani-play-button"),b=0;v.click(function(){var e=t.animationManager;l.enabledAni=!l.enabledAni,t.execute(o.commands.PLAY_ANIMATION_COMMAND,l.enabledAni),l.enabledAni?e.setProgress(b):b=e.getProgress()}),this.trackBar=$(".track .bar"),this.trackWidth=this.trackBar.width(),this.trackKnob=$(".track .knob"),this.trackKnobWidth=this.trackKnob.width(),this.resize=function(){l.trackWidth=$(".track .bar").width()},window.addEventListener("resize",this.resize),$(".nb-timeline-wrapper")[0].addEventListener("pointerdown",s);var m=0}return a(e,[{key:"update",value:function(){var e=this.babylonScene.scene,t=e.Animatables;if(t){var n=(t[0],this.babylonScene.animationManager),i=n.getProgress();if(!isNaN(i)){0===this.trackWidth&&(this.trackWidth=$(".track .bar").width());var a=this.trackWidth*i-this.trackKnobWidth;this.trackKnob.css("transform","translateX("+a+"px)")}}}},{key:"menuItemClick",value:function(e){var t=e.currentTarget.getAttribute("type");this.clearStyle(),this.playerSetting.addClass("inner-setting"),this.lastTypeEle=$("#setting-"+t),this.lastTypeEle.addClass("show")}},{key:"backBtnClick",value:function(){this.clearStyle()}},{key:"addData",value:function(e){}},{key:"clearStyle",value:function(){this.playerSetting.removeClass("inner-setting"),this.lastTypeEle&&this.lastTypeEle.removeClass("show"),delete this.lastTypeEle}},{key:"setData",value:function(e){var t=e.tips;if(t){var n=$("#nb-threed-player-ul");t.forEach(function(e){e.title=s.convertTextToHTML(e.title),n.append('<li sprite="'+e.title+'"><a href="#">'+e.title+"</a></li>")}),n.find("li").click(this.tipClick(this))}}},{key:"tipClick",value:function(e){return function(){var t=this.getAttribute("sprite");t=s.convertTextToHTML(t),e.babylonScene.lookAtSpriteByName(t)}}},{key:"showAnimationSetting",value:function(e){var t=$(".player-controls .timeline");e?(this.addSettingItem([o.setting.SPEED]),t.css("display","block")):(this.removeSettingItem([o.setting.SPEED]),t.css("display","none"))}},{key:"addSettingItem",value:function(e){var t=this;e.forEach(function(e){t.settingItemMap[e].show()})}},{key:"removeSettingItem",value:function(e){var t=this;e.forEach(function(e){t.settingItemMap[e].hide()})}},{key:"dispose",value:function(){window.removeEventListener("resize",this.resize),delete this.babylonScene,$(this.element).remove()}}]),e}();e.exports=r},function(e,t,n){"use strict";e.exports='\n<div class="player-controls">\n    <div class="threed-player">\n        <div class="btn-group cameraBtn">\n            <button data-toggle="dropdown" class="btn btn-primary dropdown-toggle glyphicon glyphicon-animation"></span></button>\n            <ul id="nb-threed-player-ul" class="dropdown-menu bullet pull-center pull-top" style="margin-right: -85px;">\n                \x3c!--添加静态快照和(动画)--\x3e\n            </ul>\n        </div>\n        \n        <div class="btn-group">\n            <button id="setting-btn" data-toggle="dropdown" class="btn btn-primary dropdown-toggle glyphicon glyphicon-setting"></button>\n            <div class="dropdown-menu bullet pull-center pull-top menu-wrapper">\n                <ul id="nb-threed-player-ul" class="dropdown-menu bullet pull-center pull-top" style="margin-right: -85px;">\n                </ul>\n                <div class="setting-wrapper">\n                    <div class="player-setting">\n                        <div class="setting-option">\n                            <div class="menu-item first-level" type="render">\n                                <p class="setting-label">渲染</p>\n                                <p class="setting-value" id="val-render">lit</p>\n                            </div>\n                            <div class="menu-item first-level" type="camera">\n                                <p class="setting-label">摄像机</p>\n                                <p class="setting-value" id="val-camera">orbit</p>\n                            </div>\n                            <div class="menu-item first-level" type="annotation">\n                                <p class="setting-label">标注</p>\n                                <p class="setting-value" id="val-annotation">显示</p>\n                            </div>\n                            <div class="menu-item first-level" type="speed">\n                                <p class="setting-label">动画速度</p>\n                                <p class="setting-value" id="val-speed">1x</p>\n                            </div>\n                        </div>\n                        <div id="level2-setting" class="setting-option">\n                            <div class="back menu-item">\n                                <p>返回</p>\n                            </div>\n                            <div class="setting menu-item" id="setting-render">\n                                <p class="select" type="render:ordinary">普通</p>\n                                <p type="render:wireframe">线框</p>\n                            </div> \n                            <div class="setting menu-item" id="setting-camera">\n                                <p class="select" type="camera:arcCamera">轨道</p>\n                                <p type="camera:freeCamera">第一人称</p>\n                                <p type="camera:vrArcCamera">VR+轨道</p>\n                                <p type="camera:vrFreeCamera">VR+第一人称</p>\n                                <p type="camera:anaglyphCamera">立体(红蓝)</p>\n                                <p type="camera:stereoscopicCamera">立体(偏振)</p>\n                            </div> \n                            <div class="setting menu-item" id="setting-annotation">\n                                <p class="select" type="anno:show">显示</p>\n                                <p type="anno:hide">隐藏</p>\n                            </div> \n                            <div class="setting menu-item" id="setting-speed">\n                                <p type="speed:0.1x">0.1x</p>\n                                <p type="speed:0.25x">0.25x</p>\n                                <p type="speed:0.5x">0.5x</p>\n                                <p class="select" type="speed:1x">1x</p>\n                                <p type="speed:2x">2x</p>\n                            </div> \n                        </div>\n                    </div>\n                </div>\n                \n            </div>\n        </div>\n\n    </div>\n\n    <div class="timeline">\n        <div class="nb-timeline-wrapper">\n            <div class="track">\n                <div class="bar"></div>\n                <div class="knob"></div>\n            </div>\n        </div>\n        \n        <span href="#" class="ani-play-button glyphicon glyphicon-pause">\n        </span>\n    </div>\n    \n\n</div>\n\n'},function(e,t,n){"use strict";function i(e){e.use(["/nb-web-3d/writeFile/:id","/nb-web-3d/writeFile/"],function(e,t){var n=e.body,i=n,s=i.path,c=e.params.id||"";s=s.replace(""+r.baseURL+c+"/","");var l="./"+r.baseURL+c+"/"+s,u=l.substr(0,l.lastIndexOf("/"));o.sync(u),a.writeFileSync(l,JSON.stringify(i.data))}),e.use("/nb-web-3d/check-env",function(e,t){t.send("success")})}var a=void 0,o=void 0;try{a=n(!function(){var e=new Error('Cannot find module "fs"');throw e.code="MODULE_NOT_FOUND",e}());var s=n(460);o=function(e,t){e=s.resolve(e),a.exists(e,function(n){n?t&&t(null):o(s.dirname(e),function(){a.mkdir(e,function(e){t&&t(e)})})})},o.sync=function(e){e=s.resolve(e),a.existsSync(e)||(o.sync(s.dirname(e)),a.mkdirSync(e))}}catch(e){console.warn("没有fs")}var r={baseURL:"course/biology"};try{r=JSON.parse(a.readFileSync("./nb3d.config.json").toString())}catch(e){console.log(e)}n(3).Buffer;e.exports=i},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={};i.event={ON_PLAYING:"timelinePlaying",ON_COMPLETE:"timelineComplete",WHEN_THROUGH_NODE:"whenThroughNode",START_DRAG:"timelineStartDrag",DRAG_MOVE:"timelineDragMove",STOP_DRAG:"timelineStopDrag",CLICK_NODE:"clickNode",CLICK_NODE_REACHED:"clickNodeReached",START_PLAYING:"startPlayingTimeline",STOP_PLAYING:"stopPlaying"},i.init=function(e){function t(){var t=this,n=t.x-E.diffX;u(!1);for(var a=0;a<L.length;a++)L[a].interactive=!1;e.emit(i.event.CLICK_NODE,{index:t.id}),TweenMax.to([E,N],b,{x:n,onUpdate:function(){c()},onComplete:function(){for(var n=0;n<L.length;n++)L[n].interactive=!0;e.emit(i.event.CLICK_NODE_REACHED,{index:t.id})}})}function n(){var t=E.x+f,n=void 0;for(n=0;n<S.length;n++)if(E.x+E.diffX<=S[n].x&&t+E.diffX>=S[n].x){e.emit(i.event.WHEN_THROUGH_NODE,{index:n});break}t>_&&(t=_,C=!0,u(!1)),E.x=t,N.x=E.x,c(),C&&e.emit(i.event.ON_COMPLETE)}function a(){var t=void 0;C?(C=!1,t=!0,E.x=P,N.x=E.x):(t=1!=B.currentFrame,E.x<_?C=!1:t=!1),t?e.emit(i.event.START_PLAYING):e.emit(i.event.STOP_PLAYING),u(t)}function o(){u(!1),B.currentFrame=1,C=!1,e.emit(i.event.START_DRAG)}function s(){var t=this;t.x<P?t.x=P:t.x>_&&(t.x=_),t.y=t.initY,e.lineMask.x=t.x,B.currentFrame=1,c()}function r(){B.currentFrame=0,e.emit(i.event.STOP_DRAG)}function c(){e.emit(i.event.ON_PLAYING,{time:E.x/_,currentNodeIndex:l()})}function l(){var e=void 0;for(e=0;e<S.length&&!(E.x+E.diffX<S[e].x);e++);return e-1}function u(e){T=e,B.currentFrame=e?1:0}function h(e){e=e||"";var t=new PIXI.Text(e,{fill:y,font:"normal "+m+"px fangzhengHJ"});return t.pivot.set(t.width/2,t.height/2),t}var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return console.error("请传入必要参数timeline"),!1;var d=Object.assign({fontSize:30,fontColor:"#ffffff",fontOffsetX:0,fontOffsetY:0,speed:1,nodeCount:2,nodeTime:.5},p),f=d.speed,v=d.nodeCount,b=d.nodeTime,m=d.fontSize,y=d.fontColor,g=d.fontOffsetX,A=d.fontOffsetY,O=d.fontTxts,x=e.line,M=e.clickNode,E=x.dragNode,w=x.lineTop,B=e.playBtn.playBtn,T=!1,C=!1,P=0,_=x.width-40,S=[],L=[],N=new PIXI.Graphics;!function(){N.beginFill("0xff0000",.1),N.drawRect(-x.width,0,x.width,x.height),N.endFill(),w.mask=N,e.lineMask=N,x.addChild(N),e.playBtn.addEventListener(TouchEvent.TAP,a),L.push(e.playBtn),E.initY=E.y,L.push(E),NBDrag.addDrag(E),E.addEventListener(NBDrag.event.START_DRAG,o),E.addEventListener(NBDrag.event.DRAG_MOVE,s),E.addEventListener(NBDrag.event.STOP_DRAG,r),M.alpha=0;var i=void 0;v>0&&(i=(x.width-40)/(v-1));for(var c=0;c<v;c++){var l=M.clone();l.x=c*i+15,l.y=0;var u="";O&&(u=O[c]);var p=h(u);p.x+=g,p.y=80+A;var d=new PIXI.Sprite;d.id=c,x.addChildAt(d,1),d.x=l.x,d.y=l.y,l.x=0,l.y=0,d.addChild(l),d.addChild(p),S.push(d),c==v-1&&(l.alpha=0),d.addEventListener(TouchEvent.TAP,t),L.push(d)}E.diffX=S[0].x-E.x,nb.MovieClip.ticker.add(function(){T&&!C&&n()})}(),e.setPlay=function(e){e&&(C=!1),u(e)},e.setDrag=function(e){NBDrag.removeDrag(E),e&&NBDrag.addDrag(E)},e.setClick=function(e){for(var t=0;t<S.length;t++)S[t].interactive=e},e.setNodeTime=function(e){b=e},e.getCurrentNodeIndex=l,e.reset=function(){C=!1,E.x=P,N.x=E.x,u(!1)},e.setSpeed=function(e){f=e}},t.default=i},,,,,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(577),o=i(a),s=n(578),r=i(s),c=n(579),l=i(c),u=n(580),h=i(u),p=n(581),d=i(p),f=n(582),v=i(f),b=n(583),m=i(b),y=n(584),g=i(y),A=n(585),O=i(A),x=n(586),M=i(x),E=n(587),w=i(E),B=n(588),T=i(B),C=n(589),P=i(C),_=n(590),S=i(_),L=n(591),N=i(L),k=n(592),Y=i(k),R=n(593),D=i(R),I=n(594),j=i(I),X=n(595),F=i(X),Z=n(596),z=i(Z),V=n(597),U=i(V),H=n(598),G=i(H),W=n(599),$=i(W),Q=n(600),K=i(Q),q=n(601),J=i(q),ee=n(602),te=i(ee),ne=n(603),ie=i(ne),ae=n(604),oe=i(ae),se=n(605),re=i(se),ce=n(606),le=i(ce),ue=n(607),he=i(ue),pe=n(608),de=i(pe),fe=n(609),ve=i(fe),be=n(610),me=i(be),ye=n(611),ge=i(ye),Ae=n(612),Oe=i(Ae),xe=n(613),Me=i(xe),Ee=n(614),we=i(Ee),Be=n(615),Te=i(Be),Ce=n(616),Pe=i(Ce),_e=n(617),Se=i(_e),Le=n(618),Ne=i(Le),ke=n(619),Ye=i(ke),Re=n(620),De=i(Re),Ie=n(621),je=i(Ie),Xe=n(622),Fe=i(Xe),Ze=n(623),ze=i(Ze),Ve=n(624),Ue=i(Ve),He=n(625),Ge=i(He),We=n(626),$e=i(We),Qe=n(627),Ke=i(Qe),qe=n(628),Je=i(qe),et=n(629),tt=i(et),nt=n(630),it=i(nt),at=n(631),ot=i(at),st=n(632),rt=i(st),ct=n(633),lt=i(ct),ut=n(634),ht=i(ut),pt=n(635),dt=i(pt),ft=n(636),vt=i(ft),bt=n(637),mt=i(bt),yt=n(638),gt=i(yt),At=n(639),Ot=i(At),xt=n(640),Mt=i(xt),Et=n(641),wt=i(Et),Bt=n(642),Tt=i(Bt),Ct=n(643),Pt=i(Ct),_t=n(644),St=i(_t),Lt=n(645),Nt=i(Lt),kt=n(646),Yt=i(kt),Rt={};Rt.AM832=o.default,Rt.AM83_012_color_01=r.default,Rt.animation_01=l.default,Rt.animation_gezi=h.default,Rt.animation_gou=d.default,Rt.animation_hudie03=v.default,Rt.animation_mayi=m.default,Rt.animation_muji=g.default,Rt.animation_qiuyin=O.default,Rt.animation_tudi=M.default,Rt.ant=w.default,Rt.ant_nb_babylon=T.default,Rt.butterFly=P.default,Rt.butterFly_nb_babylon=S.default,Rt.chicken=N.default,Rt.chicken_nb_babylon=Y.default,Rt.chitang=D.default,Rt.chitang_n=j.default,Rt.chuxu3_1=F.default,Rt.chuxu3_1_NRM=z.default,Rt.crucianCarp=U.default,Rt.crucianCarp_nb_babylon=G.default,Rt.dog=$.default,Rt.DogColTex=K.default,Rt.dog_nb_babylon=J.default,Rt.dove=te.default,Rt.dove_nb_babylon=ie.default,Rt.Earthworm=oe.default,Rt.Earthworm_nb_babylon=re.default,Rt.f1_1=le.default,Rt.f2=he.default,Rt.f2_NRM=de.default,Rt.hehua=ve.default,Rt.heye_c3=me.default,Rt.huang=ge.default,Rt.jiazi3_1=Oe.default,Rt.jiazi3_1_NRM=Me.default,Rt.jiyu=we.default,Rt.jiyu_2=Te.default,Rt.jiyu_nrm_2=Pe.default,Rt.lotus=Se.default,Rt.lotus_nb_babylon=Ne.default,Rt.mayitui10_1=Ye.default,Rt.mayitui10_1_NRM=De.default,Rt.model_ani=je.default,Rt.Muji=Fe.default,Rt.newYu=ze.default,Rt.newYu_nb_babylon=Ue.default,Rt.q2=Ge.default,Rt.quanti10_1=$e.default,Rt.quanti10_1_NRM=Ke.default,Rt.rou1=Je.default,Rt.shanti1=tt.default,Rt.shanti12_NRM=it.default,Rt.shanti1_SPEC=ot.default,Rt.snail=rt.default,Rt.snail_nb_babylon=lt.default,Rt.tudi2=ht.default,Rt.turang=dt.default,Rt.w4=vt.default,Rt.w4_NRM=mt.default,Rt.woniu=gt.default,Rt.woniu_nb_babylon=Ot.default,Rt.YE=Mt.default,Rt.yezib=wt.default,Rt.yezi_1=Tt.default,Rt.yezi_1_NRM=Pt.default,Rt.yezi_huai=St.default,Rt.yusai=Nt.default,Rt.yu_nb_babylon=Yt.default,t.default=Rt},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-6c57ac4c.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-05b0e6f8.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-eb2e4e5f.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-8d9644ca.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-80532fa5.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-56531b91.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-f1334be8.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-9d7a04d9.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-9271d717.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-32292b4c.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-7d782834.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-7d782834-2d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-1b65124f.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-1b65124f-2d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-e8228a04.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-e8228a04-2d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-2707b975.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-8fb341c5.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-787b702b.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-bf78a6b5.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-d6fcefe6.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-d6fcefe6-2d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-bd9150f0.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-78c6f3cd.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-bd9150f0-2d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-b5087ec2.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-b5087ec2-2d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-17ccae6f.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-17ccae6f-2d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-8d3a2a8b.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-2d79742c.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-b1bb3c49.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-63030208.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-a99d2cc7.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-b4d6eb70.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-5e5c0dd5.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-e6e3fae6.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-187e8e5c.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-b6f36174.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-66c0355c.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-9b371f84.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-9b371f84-2d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-5b39d63d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-439e0fa0.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-6d4ee8f2.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-d9bd5d3a.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-3767414a.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-3767414a-2d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-0876ea6a.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-e68c6df2.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-70f2801d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-47d151d7.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-8231762c.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-e091b3be.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-09823b40.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-9d159005.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-9d159005-2d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-c26d58c3.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-fb0250d7.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-af68845a.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-104cfd92.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-e7c47882.babylon"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-e7c47882-2d.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-3e263392.png"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-7a227c05.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-c45a4a59.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-044b48c9.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-416dc8d2.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-1a17e9f2.jpg"},function(e,t,n){e.exports=n.p+"nb-models/aec851e5-4021-5c49267a-2d.jpg"}]));